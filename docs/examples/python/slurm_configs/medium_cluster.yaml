# Medium Cluster Configuration - 4 Nodes
# Good for production SVGD inference (128-256 particles)

name: medium_cluster
nodes: 4
cpus_per_node: 16
memory_per_cpu: "8G"
time_limit: "02:00:00"
partition: "compute"
qos: "normal"
coordinator_port: 12345
platform: "cpu"

# Network configuration
network_interface: "ib0"

# Environment variables
env_vars:
  JAX_ENABLE_X64: "1"
  XLA_PYTHON_CLIENT_PREALLOCATE: "false"
  NCCL_SOCKET_IFNAME: "ib0"
  NCCL_DEBUG: "WARN"

# Performance tuning
env_vars_extended:
  # CPU optimization
  XLA_FLAGS: "--xla_cpu_multi_thread_eigen=true --xla_cpu_enable_fast_math=true"

# Modules to load (adjust for your cluster)
modules_to_load:
  - "python/3.11"
  - "gcc/11.2.0"
  # - "openmpi/4.1.4"

# Additional SBATCH options
extra_sbatch_options:
  exclusive: true  # Request exclusive node access
  # mail-type: "END,FAIL"
  # mail-user: "your.email@institution.edu"

# Expected performance:
# - Total devices: 4 Ã— 16 = 64
# - With 256 particles: 4 particles per device
# - Speedup: ~3.5-3.8x vs single node
# - Recommended for: Production SVGD, parameter sweeps, large models
