<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Showcase for ptdalgorithms</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-8eb735be1893943fe49fb9ca03c59cb5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../api/_styles-quartodoc.css">
<link rel="stylesheet" href="../../../numpy.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../logo.png" alt="Phasic" class="navbar-logo light-content">
    <img src="../../../logo.png" alt="Phasic" class="navbar-logo dark-content">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../pages/getting_started.html"> 
<span class="menu-text">Documentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../api/"> 
<span class="menu-text">Python API reference</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../r_api/"> 
<span class="menu-text">R API reference</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../c_api/"> 
<span class="menu-text">C API reference</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/munch-group/ptdalgorithms/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#standard-coalescent" id="toc-standard-coalescent" class="nav-link active" data-scroll-target="#standard-coalescent">Standard coalescent</a></li>
  <li><a href="#time-inhomgeneous-coalescent" id="toc-time-inhomgeneous-coalescent" class="nav-link" data-scroll-target="#time-inhomgeneous-coalescent">Time-inhomgeneous coalescent</a></li>
  <li><a href="#simple-model-in-keynote-presentation" id="toc-simple-model-in-keynote-presentation" class="nav-link" data-scroll-target="#simple-model-in-keynote-presentation">Simple model in Keynote presentation</a>
  <ul class="collapse">
  <li><a href="#super-simple-model-in-keynote-presentation" id="toc-super-simple-model-in-keynote-presentation" class="nav-link" data-scroll-target="#super-simple-model-in-keynote-presentation">Super simple model in Keynote presentation</a></li>
  </ul></li>
  <li><a href="#im-model" id="toc-im-model" class="nav-link" data-scroll-target="#im-model">IM model</a>
  <ul class="collapse">
  <li><a href="#model-with-two-loci-two-islands-with-samples-from-one-population" id="toc-model-with-two-loci-two-islands-with-samples-from-one-population" class="nav-link" data-scroll-target="#model-with-two-loci-two-islands-with-samples-from-one-population">Model with two loci, two islands, with samples from one population</a>
  <ul class="collapse">
  <li><a href="#varying-population-size-in-epoques" id="toc-varying-population-size-in-epoques" class="nav-link" data-scroll-target="#varying-population-size-in-epoques">Varying population size in epoques</a></li>
  <li><a href="#two-locus-sfs-for-a-two-island-model" id="toc-two-locus-sfs-for-a-two-island-model" class="nav-link" data-scroll-target="#two-locus-sfs-for-a-two-island-model">Two-locus SFS for a two-island model</a></li>
  <li><a href="#marginal-sfss-for-each-locus" id="toc-marginal-sfss-for-each-locus" class="nav-link" data-scroll-target="#marginal-sfss-for-each-locus">Marginal SFSs for each locus</a></li>
  <li><a href="#covariance-of-arg-branches-in-the-two-populations" id="toc-covariance-of-arg-branches-in-the-two-populations" class="nav-link" data-scroll-target="#covariance-of-arg-branches-in-the-two-populations">Covariance of ARG branches in the two populations</a></li>
  <li><a href="#covriance-between-tons-at-each-locus" id="toc-covriance-between-tons-at-each-locus" class="nav-link" data-scroll-target="#covriance-between-tons-at-each-locus">Covriance between tons at each locus</a></li>
  </ul></li>
  <li><a href="#rabbit-model" id="toc-rabbit-model" class="nav-link" data-scroll-target="#rabbit-model">Rabbit model</a></li>
  <li><a href="#running-time-experiments" id="toc-running-time-experiments" class="nav-link" data-scroll-target="#running-time-experiments">Running time experiments</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Showcase for ptdalgorithms</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Python header:</p>
<div id="9801ed3e" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext rpy2.ipython</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'ticks'</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib_inline.backend_inline <span class="im">import</span> set_matplotlib_formats</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>set_matplotlib_formats(<span class="st">'retina'</span>, <span class="st">'png'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_graph(states, ipv, sim, constrained<span class="op">=</span><span class="va">True</span>, size<span class="op">=</span><span class="st">'10'</span>):</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    constrained <span class="op">=</span> constrained <span class="kw">and</span> <span class="st">'true'</span> <span class="kw">or</span> <span class="st">'false'</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    states <span class="op">=</span> np.array(states)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add the missing row and col to SIM</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    rates <span class="op">=</span> np.r_[np.c_[sim, <span class="op">-</span>sim.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)], np.zeros((<span class="dv">1</span>, <span class="bu">len</span>(sim)<span class="op">+</span><span class="dv">1</span>))]</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    dot <span class="op">=</span> Digraph()</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    dot.node(<span class="st">'S'</span>, <span class="st">'S'</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(states)):</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        dot.node(<span class="bu">str</span>(i), <span class="bu">str</span>(states[i]))</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(ipv)):</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ipv[i]:</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>            dot.edge(<span class="st">'S'</span>, <span class="bu">str</span>(i<span class="op">+</span><span class="dv">1</span>), constraint<span class="op">=</span>constrained, label<span class="op">=</span><span class="bu">str</span>(ipv[i]))</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(states)):</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(states)):</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">!=</span> j <span class="kw">and</span> rates[i<span class="op">-</span><span class="dv">1</span>, j<span class="op">-</span><span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                dot.edge(<span class="bu">str</span>(i), <span class="bu">str</span>(j), constraint<span class="op">=</span>constrained, label<span class="op">=</span><span class="bu">str</span>(rates[i<span class="op">-</span><span class="dv">1</span>, j<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    dot.graph_attr[<span class="st">'size'</span>] <span class="op">=</span> size                </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>R header:</p>
<div id="37fc70fa" class="cell" data-tags="[]" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>library(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>library(devtools)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>remove.packages(<span class="st">"ptdalgorithms"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>devtools::install_github(<span class="st">"TobiasRoikjer/PtDAlgorithms"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>library(ptdalgorithms)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>R[write to console]: Removing package from ‘/Users/kmt/miniconda3/envs/phasetypes/lib/R/library’
(as ‘lib’ is unspecified)

R[write to console]: Updating HTML index of packages in '.Library'

R[write to console]: Making 'packages.html' ...
R[write to console]:  done

R[write to console]: Downloading GitHub repo TobiasRoikjer/PtDAlgorithms@HEAD
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>* checking for file ‘/private/var/folders/33/sv_s_4ps2gjgpwdxjvz9jly00000gn/T/RtmpmKKfNf/remotes123b76f7b0b3/TobiasRoikjer-PtDAlgorithms-d022b12/DESCRIPTION’ ... OK
* preparing ‘ptdalgorithms’:
* checking DESCRIPTION meta-information ... OK
* cleaning src
* checking for LF line-endings in source and make files and shell scripts
* checking for empty or unneeded directories
Omitted ‘LazyData’ from DESCRIPTION
* building ‘ptdalgorithms_1.0.0.tar.gz’
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>* installing *source* package ‘ptdalgorithms’ ...
** using staged installation
** libs</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>x86_64-apple-darwin13.4.0-clang++ -std=gnu++14 -I"/Users/kmt/miniconda3/envs/phasetypes/lib/R/include" -DNDEBUG  -I'/Users/kmt/miniconda3/envs/phasetypes/lib/R/library/Rcpp/include' -D_FORTIFY_SOURCE=2 -isystem /Users/kmt/miniconda3/envs/phasetypes/include -mmacosx-version-min=10.9 -I/Users/kmt/miniconda3/envs/phasetypes/include  -I../api/cpp -I../api/c -Ic/ -Icpp/ -fPIC  -march=core2 -mtune=haswell -mssse3 -ftree-vectorize -fPIC -fPIE -fstack-protector-strong -O2 -pipe -stdlib=libc++ -fvisibility-inlines-hidden  -fmessage-length=0 -isystem /Users/kmt/miniconda3/envs/phasetypes/include -fdebug-prefix-map=/Users/runner/miniforge3/conda-bld/r-base-split_1639563465184/work=/usr/local/src/conda/r-base-4.1.2 -fdebug-prefix-map=/Users/kmt/miniconda3/envs/phasetypes=/usr/local/src/conda-prefix  -c RcppExports.cpp -o RcppExports.o
x86_64-apple-darwin13.4.0-clang++ -std=gnu++14 -I"/Users/kmt/miniconda3/envs/phasetypes/lib/R/include" -DNDEBUG  -I'/Users/kmt/miniconda3/envs/phasetypes/lib/R/library/Rcpp/include' -D_FORTIFY_SOURCE=2 -isystem /Users/kmt/miniconda3/envs/phasetypes/include -mmacosx-version-min=10.9 -I/Users/kmt/miniconda3/envs/phasetypes/include  -I../api/cpp -I../api/c -Ic/ -Icpp/ -fPIC  -march=core2 -mtune=haswell -mssse3 -ftree-vectorize -fPIC -fPIE -fstack-protector-strong -O2 -pipe -stdlib=libc++ -fvisibility-inlines-hidden  -fmessage-length=0 -isystem /Users/kmt/miniconda3/envs/phasetypes/include -fdebug-prefix-map=/Users/runner/miniforge3/conda-bld/r-base-split_1639563465184/work=/usr/local/src/conda/r-base-4.1.2 -fdebug-prefix-map=/Users/kmt/miniconda3/envs/phasetypes=/usr/local/src/conda-prefix  -c ptdalgorithms.cpp -o ptdalgorithms.o
x86_64-apple-darwin13.4.0-clang++ -std=gnu++14 -dynamiclib -Wl,-headerpad_max_install_names -undefined dynamic_lookup -single_module -multiply_defined suppress -L/Users/kmt/miniconda3/envs/phasetypes/lib/R/lib -Wl,-dead_strip_dylibs -Wl,-pie -Wl,-headerpad_max_install_names -Wl,-dead_strip_dylibs -Wl,-rpath,/Users/kmt/miniconda3/envs/phasetypes/lib -L/Users/kmt/miniconda3/envs/phasetypes/lib -o ptdalgorithms.dylib RcppExports.o ptdalgorithms.o -L/Users/kmt/miniconda3/envs/phasetypes/lib/R/lib -lR -Wl,-framework -Wl,CoreFoundation</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ld: warning: -pie being ignored. It is only used when linking a main executable
installing to /Users/kmt/miniconda3/envs/phasetypes/lib/R/library/00LOCK-ptdalgorithms/00new/ptdalgorithms/libs
** R
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded from temporary location
** checking absolute paths in shared objects and dynamic libraries
** testing if installed package can be loaded from final location
** testing if installed package keeps a record of temporary installation path
* DONE (ptdalgorithms)</code></pre>
</div>
</div>
<section id="standard-coalescent" class="level2">
<h2 class="anchored" data-anchor-id="standard-coalescent">Standard coalescent</h2>
<p>If you already have the subintensity matrix and initial probability vector:</p>
<div id="7a7b48b2" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o sim <span class="op">-</span>o ipv</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sim <span class="op">=</span> matrix(c(<span class="op">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">0</span>, <span class="dv">0</span>, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>               <span class="dv">0</span>, <span class="op">-</span><span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>               <span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>               <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>), nrow<span class="op">=</span><span class="dv">4</span>, ncol<span class="op">=</span><span class="dv">4</span>, byrow <span class="op">=</span> TRUE)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ipv <span class="op">=</span> c(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>sim</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]   -6    6    0    0
[2,]    0   -3    1    2
[3,]    0    0   -1    0
[4,]    0    0    0   -1</code></pre>
</div>
</div>
<div id="c30d455a" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>graph <span class="op">&lt;-</span> matrix_as_graph(ipv, sim)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Note that the state vectors are ofcause undefined (all zero) when constructing the graph this way:</p>
<div id="0814e96e" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>graph_as_matrix(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$states
     [,1]
[1,]    0
[2,]    0
[3,]    0
[4,]    0

$SIM
     [,1] [,2] [,3] [,4]
[1,]   -6    6    0    0
[2,]    0   -3    1    2
[3,]    0    0   -1    0
[4,]    0    0    0   -1

$IPV
[1] 1 0 0 0
</code></pre>
</div>
</div>
<div id="141ca6ef" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dph(<span class="fl">0.9</span>, graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5362689</code></pre>
</div>
</div>
<p>If you want to generate the state space:</p>
<div id="67315ff9" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o states <span class="op">-</span>o ipv <span class="op">-</span>o sim <span class="op">-</span>o n <span class="op">-</span>o graph</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>n <span class="op">&lt;-</span> <span class="dv">6</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>state_vector_length <span class="op">&lt;-</span> n</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>graph <span class="op">&lt;-</span> create_graph(state_vector_length)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>starting_vertex <span class="op">&lt;-</span> vertex_at(graph, <span class="dv">1</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>initial_state <span class="op">&lt;-</span> rep(<span class="dv">0</span>, n)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>initial_state[<span class="dv">1</span>] <span class="op">&lt;-</span> n</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>add_edge(</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  starting_vertex,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  create_vertex(graph, initial_state),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>index <span class="op">&lt;-</span> <span class="dv">2</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (index <span class="op">&lt;=</span> vertices_length(graph)) {</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  vertex <span class="op">&lt;-</span> vertex_at(graph, index)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop over all classes of lineages</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="kw">in</span> <span class="dv">1</span>:n) {</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="kw">in</span> i:n) {</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      state <span class="op">&lt;-</span> vertex$state</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># if same class, there need to be at least two to coalesce</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">==</span> j) {</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (state[i] <span class="op">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>          <span class="bu">next</span><span class="op">;</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># coal rate</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        rate <span class="op">&lt;-</span> state[i] <span class="op">*</span> (state[i] <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># else at least one in each class to coalesce</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (state[i] <span class="op">&lt;</span> <span class="dv">1</span> <span class="op">||</span> state[j] <span class="op">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>          <span class="bu">next</span><span class="op">;</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># number of combinations</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>        rate <span class="op">&lt;-</span> state[i] <span class="op">*</span> state[j]</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># copy state</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>      child_state <span class="op">&lt;-</span> state</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>      <span class="co"># update child state</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>      child_state[i] <span class="op">&lt;-</span> child_state[i] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>      child_state[j] <span class="op">&lt;-</span> child_state[j] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>      child_state[i<span class="op">+</span>j] <span class="op">&lt;-</span> child_state[i<span class="op">+</span>j] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>      add_edge(</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>          vertex,</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>          find_or_create_vertex(graph, child_state),</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>          rate, c(rate)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>  index <span class="op">&lt;-</span> index <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>states <span class="op">&lt;-</span> t(sapply(<span class="dv">1</span>:vertices_length(graph), function(index) vertex_at(graph, index)$state ))</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>ipv <span class="op">&lt;-</span> graph_as_matrix(graph)$IPV</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>sim <span class="op">&lt;-</span> graph_as_matrix(graph)$SIM</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>vertices_length(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
</div>
<div id="2a36bd85" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plot_graph(states, ipv, sim)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-9-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="showcase_files/figure-html/cell-9-output-1.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>As matrices:</p>
<div id="8fa9bf2f" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o states <span class="op">-</span>o sim</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>matrices <span class="op">&lt;-</span> graph_as_matrix(graph)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>states <span class="op">&lt;-</span> matrices$states</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>sim <span class="op">&lt;-</span> matrices$SIM</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>matrices</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$states
      [,1] [,2] [,3] [,4] [,5] [,6]
 [1,]    6    0    0    0    0    0
 [2,]    4    1    0    0    0    0
 [3,]    2    2    0    0    0    0
 [4,]    3    0    1    0    0    0
 [5,]    0    3    0    0    0    0
 [6,]    1    1    1    0    0    0
 [7,]    2    0    0    1    0    0
 [8,]    0    0    2    0    0    0
 [9,]    0    1    0    1    0    0
[10,]    1    0    0    0    1    0

$SIM
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
 [1,]  -15   15    0    0    0    0    0    0    0     0
 [2,]    0  -10    6    4    0    0    0    0    0     0
 [3,]    0    0   -6    0    1    4    1    0    0     0
 [4,]    0    0    0   -6    0    3    3    0    0     0
 [5,]    0    0    0    0   -3    0    0    0    3     0
 [6,]    0    0    0    0    0   -3    0    1    1     1
 [7,]    0    0    0    0    0    0   -3    0    1     2
 [8,]    0    0    0    0    0    0    0   -1    0     0
 [9,]    0    0    0    0    0    0    0    0   -1     0
[10,]    0    0    0    0    0    0    0    0    0    -1

$IPV
 [1] 1 0 0 0 0 0 0 0 0 0
</code></pre>
</div>
</div>
<p>Invert subintensity matrix to get Green matrix:</p>
<div id="7789df73" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>U <span class="op">&lt;-</span> <span class="op">-</span>solve(matrices$SIM)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>U</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1] [,2]      [,3]       [,4]       [,5]      [,6]       [,7]
 [1,] 0.06666667  0.1 0.1000000 0.06666667 0.03333333 0.2000000 0.10000000
 [2,] 0.00000000  0.1 0.1000000 0.06666667 0.03333333 0.2000000 0.10000000
 [3,] 0.00000000  0.0 0.1666667 0.00000000 0.05555556 0.2222222 0.05555556
 [4,] 0.00000000  0.0 0.0000000 0.16666667 0.00000000 0.1666667 0.16666667
 [5,] 0.00000000  0.0 0.0000000 0.00000000 0.33333333 0.0000000 0.00000000
 [6,] 0.00000000  0.0 0.0000000 0.00000000 0.00000000 0.3333333 0.00000000
 [7,] 0.00000000  0.0 0.0000000 0.00000000 0.00000000 0.0000000 0.33333333
 [8,] 0.00000000  0.0 0.0000000 0.00000000 0.00000000 0.0000000 0.00000000
 [9,] 0.00000000  0.0 0.0000000 0.00000000 0.00000000 0.0000000 0.00000000
[10,] 0.00000000  0.0 0.0000000 0.00000000 0.00000000 0.0000000 0.00000000
           [,8]      [,9]     [,10]
 [1,] 0.2000000 0.4000000 0.4000000
 [2,] 0.2000000 0.4000000 0.4000000
 [3,] 0.2222222 0.4444444 0.3333333
 [4,] 0.1666667 0.3333333 0.5000000
 [5,] 0.0000000 1.0000000 0.0000000
 [6,] 0.3333333 0.3333333 0.3333333
 [7,] 0.0000000 0.3333333 0.6666667
 [8,] 1.0000000 0.0000000 0.0000000
 [9,] 0.0000000 1.0000000 0.0000000
[10,] 0.0000000 0.0000000 1.0000000</code></pre>
</div>
</div>
<p>Compute expectation from matrices:</p>
<div id="ba176207" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>matrices$IPV <span class="op">%*%</span> U <span class="op">%*%</span> rep(<span class="dv">1</span>, length(matrices$IPV))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 1.666667</code></pre>
</div>
</div>
<p>Compute moments:</p>
<div id="4081ad04" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>expectation(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.666667</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
</div>
<div id="52d44d84" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>expected_waiting_time(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.666667 1.666667 1.600000 1.500000 1.500000 1.333333 1.333333 1.333333
 [9] 1.000000 1.000000 1.000000 0.000000</code></pre>
</div>
</div>
<div id="feac38a7" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>variance(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.153333</code></pre>
</div>
</div>
<div id="bcf3655a" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">*</span> expected_waiting_time(graph, expected_waiting_time(graph)) <span class="op">-</span> expected_waiting_time(graph) <span class="op">*</span> expected_waiting_time(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.153333 1.153333 1.148889 1.138889 1.138889 1.111111 1.111111 1.111111
 [9] 1.000000 1.000000 1.000000 0.000000</code></pre>
</div>
</div>
<div id="6a431795" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>moments(graph, <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1.666667  3.931111 12.482222 50.914400</code></pre>
</div>
</div>
<p>Marginal expectations using rewards:</p>
<div id="8018e9af" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>state_matrix <span class="op">&lt;-</span> sapply(<span class="dv">1</span>:vertices_length(graph), function(index) vertex_at(graph, index)$state )</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>state_matrix</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]
[1,]    0    6    4    2    3    0    1    2    0     0     1     0
[2,]    0    0    1    2    0    3    1    0    1     0     0     0
[3,]    0    0    0    0    1    0    1    0    0     2     0     0
[4,]    0    0    0    0    0    0    0    1    1     0     0     0
[5,]    0    0    0    0    0    0    0    0    0     0     1     0
[6,]    0    0    0    0    0    0    0    0    0     0     0     1</code></pre>
</div>
</div>
<p>Rows happens to be our reward vectors. E.g. singleton rewards:</p>
<div id="303e4276" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>rewards <span class="op">&lt;-</span> sapply(<span class="dv">1</span>:vertices_length(graph), function(index) vertex_at(graph, index)$state )</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>singletons <span class="op">&lt;-</span> rewards[<span class="dv">1</span>,]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>doubletons <span class="op">&lt;-</span> rewards[<span class="dv">2</span>,]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>tripletons <span class="op">&lt;-</span> rewards[<span class="dv">3</span>,]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>singletons</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 6 4 2 3 0 1 2 0 0 1 0</code></pre>
</div>
</div>
<p>Expected tripleton branch length:</p>
<div id="93c7bc1f" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>expectation(graph, tripletons)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6666667</code></pre>
</div>
</div>
<p>SFS:</p>
<div id="aab5692f" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o sfs</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>sfs <span class="op">&lt;-</span> sapply(<span class="dv">1</span>:(dim(rewards)[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span>), function(i) expectation(graph, rewards[i,]))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>sfs</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.0000000 1.0000000 0.6666667 0.5000000 0.4000000</code></pre>
</div>
</div>
<div id="1074eb69" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(sfs)<span class="op">+</span><span class="dv">1</span>)), y<span class="op">=</span>sfs)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>sns.despine()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-22-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="showcase_files/figure-html/cell-22-output-1.png" width="380" height="251" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Covariance:</p>
<div id="33738e0e" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>covariance(graph, singletons, doubletons)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1733333</code></pre>
</div>
</div>
<div id="9ea697d8" class="cell" data-tags="[]" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>covariance(graph, singletons, tripletons)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1</code></pre>
</div>
</div>
<p>Covariane between “ton” branch length:</p>
<div id="16a84314-669c-43d8-861d-98ce8844795a" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o cov_mat</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>cov_mat <span class="op">&lt;-</span> matrix(nrow<span class="op">=</span>n<span class="op">-</span><span class="dv">1</span>,ncol<span class="op">=</span>n<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="kw">in</span> <span class="dv">1</span>:(n<span class="op">-</span><span class="dv">1</span>)) {</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="kw">in</span> <span class="dv">1</span>:(n<span class="op">-</span><span class="dv">1</span>)) {</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>        cov_mat[i, j] <span class="op">&lt;-</span> covariance(graph, rewards[i,], rewards[j,])</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="0abbd20d-e6e7-42ea-a110-394c144fc4a5" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">int</span>(n)))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(cov_mat, cmap<span class="op">=</span><span class="st">"PiYG"</span>, </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                yticklabels<span class="op">=</span>ticks,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                xticklabels<span class="op">=</span>ticks</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-26-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="showcase_files/figure-html/cell-26-output-1.png" width="410" height="305" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Distributions of each “ton” branch length:</p>
<div id="3e385fc3" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o result</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> data.frame()</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="kw">in</span> <span class="dv">1</span>:(dim(rewards)[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span>)) {</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">&lt;-</span> seq(<span class="im">from</span> <span class="op">=</span> <span class="dv">0</span>, to <span class="op">=</span> <span class="dv">5</span>, by <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    pdf <span class="op">&lt;-</span> dph(x, reward_transform(graph, rewards[i, ]))</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    df <span class="op">&lt;-</span> data.frame(prob <span class="op">=</span> pdf, t<span class="op">=</span>x, ton<span class="op">=</span>i)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    result <span class="op">&lt;-</span> rbind(result, df)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">#result %&gt;% ggplot(aes(y=prob, x=t, color=ton, group=ton)) + geom_line(size=1)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="54057173" class="cell" data-tags="[]" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>result, y<span class="op">=</span><span class="st">'prob'</span>, x<span class="op">=</span><span class="st">'t'</span>, hue<span class="op">=</span><span class="st">'ton'</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>sns.despine()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-28-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="showcase_files/figure-html/cell-28-output-1.png" width="395" height="266" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Compute expectations from the distributions:</p>
<div id="41b8900d" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o sfs</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>ctx <span class="op">&lt;-</span> distribution_context(graph,<span class="dv">1000</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>prev_size <span class="op">&lt;-</span> <span class="dv">0</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (distribution_context_state(ctx)$cdf <span class="op">&lt;</span> <span class="fl">0.999</span>) { </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    distribution_context_step(ctx)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>expected_visits <span class="op">&lt;-</span> distribution_context_accumulated_visiting_time(ctx)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>sfs <span class="op">&lt;-</span> sapply(<span class="dv">1</span>:(dim(rewards)[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span>), function(i) <span class="bu">sum</span>(expected_visits <span class="op">*</span> rewards[i,]))</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>sfs</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.9996008 0.9996008 0.6662674 0.4996008 0.3996008</code></pre>
</div>
</div>
<div id="0c2508d2" class="cell" data-tags="[]" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(sfs)<span class="op">+</span><span class="dv">1</span>)), y<span class="op">=</span>sfs)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>sns.despine()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-30-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="showcase_files/figure-html/cell-30-output-1.png" width="380" height="251" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Changing rates (edge weights) using parametrization:</p>
<div id="0f280429" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o states <span class="op">-</span>o ipv <span class="op">-</span>o sim</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>graph_update_weights_parameterized(graph, c(<span class="dv">2</span>))</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>states <span class="op">&lt;-</span> t(sapply(<span class="dv">1</span>:vertices_length(graph), function(index) vertex_at(graph, index)$state ))</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>ipv <span class="op">&lt;-</span> graph_as_matrix(graph)$IPV</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>sim <span class="op">&lt;-</span> graph_as_matrix(graph)$SIM</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Change rates back to normal:</p>
<div id="e29a2c07" class="cell" data-tags="[]" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>plot_graph(states, ipv, sim)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-32-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="showcase_files/figure-html/cell-32-output-1.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="3d0813d3" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o states <span class="op">-</span>o ipv <span class="op">-</span>o sim</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>graph_update_weights_parameterized(graph, c(<span class="dv">1</span>))</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>states <span class="op">&lt;-</span> t(sapply(<span class="dv">1</span>:vertices_length(graph), function(index) vertex_at(graph, index)$state ))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>ipv <span class="op">&lt;-</span> graph_as_matrix(graph)$IPV</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>sim <span class="op">&lt;-</span> graph_as_matrix(graph)$SIM</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="0d5d4690" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plot_graph(states, ipv, sim)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-34-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="showcase_files/figure-html/cell-34-output-1.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="time-inhomgeneous-coalescent" class="level2">
<h2 class="anchored" data-anchor-id="time-inhomgeneous-coalescent">Time-inhomgeneous coalescent</h2>
<p>The distribution context is always made on the graph without rewards transformation. You can then:</p>
<ul>
<li>Get the distribution (and from that all moments) of time to absorbtion. Note that you cannot use dph for this as this assumes the current edge-weights and not seqentially updated ones in the distribution context.</li>
<li>Get the marginal exepectations by summing over the products of the expected accumulated visiting times and rewards.</li>
</ul>
<div id="f05d5aed" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o cdf1 <span class="op">-</span>o cdf2 <span class="op">-</span>o cdf3</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>cdf_timeinhom <span class="op">&lt;-</span> function(graph, eqopues, sizes) {</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    tmrca_pdf <span class="op">&lt;-</span> c()</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    time <span class="op">&lt;-</span> c()</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    ctx <span class="op">&lt;-</span> distribution_context(graph, <span class="dv">1000</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    prev_size <span class="op">&lt;-</span> <span class="dv">0</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (distribution_context_state(ctx)$cdf <span class="op">&lt;</span> <span class="fl">0.999</span>) { </span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>        tmrca_pdf[[(length(tmrca_pdf) <span class="op">+</span> <span class="dv">1</span>)]] <span class="op">&lt;-</span> distribution_context_state(ctx)$cdf</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>        time[[(length(time) <span class="op">+</span> <span class="dv">1</span>)]] <span class="op">&lt;-</span> distribution_context_state(ctx)$time</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>        size <span class="op">&lt;-</span> sizes[findInterval(distribution_context_state(ctx)$time, epoques)]</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (size <span class="op">!=</span> prev_size) {</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>            graph_update_weights_parameterized(graph, c(<span class="dv">1</span><span class="op">/</span>size))</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>        prev_size <span class="op">&lt;-</span> size</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>        distribution_context_step(ctx)</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(data.frame(prob <span class="op">=</span> unlist(tmrca_pdf), t<span class="op">=</span>unlist(time)))</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>epoques <span class="op">=</span> c(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>cdf1 <span class="op">&lt;-</span> cdf_timeinhom(graph, epoques, c(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>cdf2 <span class="op">&lt;-</span> cdf_timeinhom(graph, epoques, c(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>))</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>cdf3 <span class="op">&lt;-</span> cdf_timeinhom(graph, epoques, c(<span class="dv">16</span>, <span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="228f1a79" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(cdf1.t, cdf1.prob)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(cdf2.t, cdf2.prob)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(cdf3.t, cdf3.prob)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>sns.despine()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-36-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="showcase_files/figure-html/cell-36-output-1.png" width="708" height="251" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="30e2247f" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o sfs1 <span class="op">-</span>o sfs2 <span class="op">-</span>o sfs3</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>sfs_timeinhom <span class="op">&lt;-</span> function(graph, eqopues, sizes) {</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    tmrca_pdf <span class="op">&lt;-</span> c()</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    time <span class="op">&lt;-</span> c()</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    ctx <span class="op">&lt;-</span> distribution_context(graph, <span class="dv">1000</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    prev_size <span class="op">&lt;-</span> <span class="dv">0</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (distribution_context_state(ctx)$cdf <span class="op">&lt;</span> <span class="fl">0.999</span>) { </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># tmrca_pdf &lt;- c(tmrca_pdf, distribution_context_state(ctx)$pdf)</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># time &lt;- c(time, distribution_context_state(ctx)$time)</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>        tmrca_pdf[[(length(tmrca_pdf) <span class="op">+</span> <span class="dv">1</span>)]] <span class="op">&lt;-</span> distribution_context_state(ctx)$pdf</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>        time[[(length(time) <span class="op">+</span> <span class="dv">1</span>)]] <span class="op">&lt;-</span> distribution_context_state(ctx)$time</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>        size <span class="op">&lt;-</span> sizes[findInterval(distribution_context_state(ctx)$time, epoques)]</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (size <span class="op">!=</span> prev_size) {</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>            graph_update_weights_parameterized(graph, c(<span class="dv">1</span><span class="op">/</span>size))</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>        prev_size <span class="op">&lt;-</span> size</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>        distribution_context_step(ctx)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>    expected_visits <span class="op">&lt;-</span> distribution_context_accumulated_visiting_time(ctx)</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>    sfs <span class="op">&lt;-</span> c()</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="kw">in</span> <span class="dv">1</span>:(dim(rewards)[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span>)) {</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>        sfs <span class="op">&lt;-</span> c(sfs, <span class="bu">sum</span>(expected_visits <span class="op">*</span> rewards[i, ]))</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(sfs)</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>epoques <span class="op">=</span> c(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>sfs1 <span class="op">&lt;-</span> sfs_timeinhom(graph, epoques, c(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>sfs2 <span class="op">&lt;-</span> sfs_timeinhom(graph, epoques, c(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>))</span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>sfs3 <span class="op">&lt;-</span> sfs_timeinhom(graph, epoques, c(<span class="dv">16</span>, <span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="351e10e1" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(sfs1)<span class="op">+</span><span class="dv">1</span>)), y<span class="op">=</span>sfs1, ax<span class="op">=</span>axes[<span class="dv">0</span>]).set_title(<span class="st">"Constant 1"</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(sfs2)<span class="op">+</span><span class="dv">1</span>)), y<span class="op">=</span>sfs2, ax<span class="op">=</span>axes[<span class="dv">1</span>]).set_title(<span class="st">"Exp growth from 1"</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(sfs3)<span class="op">+</span><span class="dv">1</span>)), y<span class="op">=</span>sfs3, ax<span class="op">=</span>axes[<span class="dv">2</span>]).set_title(<span class="st">"Exp decline to 1"</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>sns.despine()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-38-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="showcase_files/figure-html/cell-38-output-1.png" width="714" height="266" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="simple-model-in-keynote-presentation" class="level1">
<h1>Simple model in Keynote presentation</h1>
<div id="1327d8a4" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o states <span class="op">-</span>o ipv <span class="op">-</span>o sim</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>graph <span class="op">&lt;-</span> create_graph(<span class="dv">1</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>A <span class="op">&lt;-</span> create_vertex(graph, c(<span class="dv">1</span>))</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>B <span class="op">&lt;-</span> create_vertex(graph, c(<span class="dv">2</span>))</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>C <span class="op">&lt;-</span> create_vertex(graph, c(<span class="dv">3</span>))</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>D <span class="op">&lt;-</span> create_vertex(graph, c(<span class="dv">4</span>))</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>add_edge(starting_vertex(graph), A, <span class="dv">1</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>add_edge(A, B, <span class="fl">0.12</span>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>add_edge(A, D, <span class="fl">0.08</span>)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>add_edge(B, C, <span class="fl">0.25</span>)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>add_edge(B, D, <span class="fl">0.25</span>)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>add_edge(C, A, <span class="fl">0.2</span>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>states <span class="op">&lt;-</span> t(sapply(<span class="dv">1</span>:vertices_length(graph), function(index) vertex_at(graph, index)$state, simplify <span class="op">=</span> FALSE))</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>ipv <span class="op">&lt;-</span> graph_as_matrix(graph)$IPV</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>sim <span class="op">&lt;-</span> graph_as_matrix(graph)$SIM</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>vertices_length(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
<div id="a020d9eb" class="cell" data-execution_count="44">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>plot_graph(states, ipv, sim)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-40-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="showcase_files/figure-html/cell-40-output-1.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>States:</p>
<div id="7d656566" class="cell" data-execution_count="45">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>expected_waiting_time(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11 11 10 16  0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
</div>
<p>Convert graph to matrix:</p>
<div id="5b1df16e" class="cell" data-execution_count="46">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>graph_as_matrix(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$states
     [,1]
[1,]    3
[2,]    2
[3,]    1

$SIM
      [,1]  [,2] [,3]
[1,] -0.20  0.00  0.2
[2,]  0.25 -0.50  0.0
[3,]  0.00  0.12 -0.2

$IPV
[1] 0 0 1
</code></pre>
</div>
</div>
<p>Invert subintensity matrix to get Green matrix:</p>
<div id="ca6ce192" class="cell" data-execution_count="47">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o U</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>U <span class="op">&lt;-</span> <span class="op">-</span>solve(graph_as_matrix(graph)$SIM)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>U</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]     [,2]     [,3]
[1,] 7.142857 1.714286 7.142857
[2,] 3.571429 2.857143 3.571429
[3,] 2.142857 1.714286 7.142857</code></pre>
</div>
</div>
<p>Sum first row of Green matrix to get expectation:</p>
<div id="2ed1ac49" class="cell" data-execution_count="48">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>rowSums(U)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16 10 11</code></pre>
</div>
</div>
<div id="583b8ac8-c650-4e5c-8f2d-efdcbfb21d7e" class="cell" data-execution_count="49">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>variance(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 139</code></pre>
</div>
</div>
<div id="b45719b0-5458-475d-acd1-0422d92b5be3" class="cell" data-execution_count="50">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>r_prime <span class="op">&lt;-</span> expected_waiting_time(graph)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>r_prime</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11 11 10 16  0</code></pre>
</div>
</div>
<div id="4a40135c-0d31-439d-a89d-4197151d13f1" class="cell" data-execution_count="51">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">*</span> expected_waiting_time(graph, r_prime) <span class="op">-</span> r_prime <span class="op">*</span> r_prime</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 139 139 150 164   0</code></pre>
</div>
</div>
<section id="super-simple-model-in-keynote-presentation" class="level2">
<h2 class="anchored" data-anchor-id="super-simple-model-in-keynote-presentation">Super simple model in Keynote presentation</h2>
<p>Simplest possible model as example of how higher order moments are computed.</p>
<div id="13d514b2" class="cell" data-execution_count="52">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o states <span class="op">-</span>o ipv <span class="op">-</span>o sim</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>graph <span class="op">&lt;-</span> create_graph(<span class="dv">1</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>A <span class="op">&lt;-</span> create_vertex(graph, c(<span class="dv">1</span>))</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>B <span class="op">&lt;-</span> create_vertex(graph, c(<span class="dv">2</span>))</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>C <span class="op">&lt;-</span> create_vertex(graph, c(<span class="dv">3</span>))</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>D <span class="op">&lt;-</span> create_vertex(graph, c(<span class="dv">4</span>))</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>add_edge(starting_vertex(graph), A, <span class="dv">1</span>)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>add_edge(A, B, <span class="dv">1</span>)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>add_edge(B, C, <span class="dv">1</span>)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>add_edge(C, D, <span class="dv">1</span>)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>states <span class="op">&lt;-</span> t(sapply(<span class="dv">1</span>:vertices_length(graph), function(index) vertex_at(graph, index)$state, simplify <span class="op">=</span> FALSE))</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>ipv <span class="op">&lt;-</span> graph_as_matrix(graph)$IPV</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>sim <span class="op">&lt;-</span> graph_as_matrix(graph)$SIM</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="bcc254f7" class="cell" data-execution_count="53">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>plot_graph(states, ipv, sim, constrained<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-49-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="showcase_files/figure-html/cell-49-output-1.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="868e1f2e" class="cell" data-execution_count="54">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>expected_waiting_time(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 3 2 1 0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
</div>
<div id="a9e22d8a" class="cell" data-execution_count="55">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>expected_waiting_time(graph, expected_waiting_time(graph))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6 6 3 1 0</code></pre>
</div>
</div>
<div id="6d4098ab" class="cell" data-execution_count="56">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>moments(graph, <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  3 12 60</code></pre>
</div>
</div>
<div id="cda96574" class="cell" data-execution_count="57">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">*</span> expected_waiting_time(graph, expected_waiting_time(graph)) <span class="op">-</span> expected_waiting_time(graph) <span class="op">*</span> expected_waiting_time(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 3 2 1 0</code></pre>
</div>
</div>
<div id="7d186480" class="cell" data-execution_count="58">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>variance(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
</section>
</section>
<section id="im-model" class="level1">
<h1>IM model</h1>
<p>Each state has the following three properties: 1. nr decendants in population 1 2. nr decendants in population 2 3. what population the lineage is currently in</p>
<div id="994bb07e" class="cell" data-execution_count="59">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>Rcpp::sourceCpp(<span class="st">"./isolation_migration.cpp"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>ld: warning: -pie being ignored. It is only used when linking a main executable</code></pre>
</div>
</div>
<p>Comparing results for numerical accuracy for an “infinite” IM stage</p>
<div id="2c7a4303" class="cell" data-execution_count="60">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o matrix_expectation <span class="op">-</span>o algorithm_expectation <span class="op">-</span>o simulation_expectation <span class="op">-</span>o distribution_expectation </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>n1 <span class="op">&lt;-</span> <span class="dv">4</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>n2 <span class="op">&lt;-</span> <span class="dv">4</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>g <span class="op">&lt;-</span> construct_im_graph(n1,n2,<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>expected_visits <span class="op">&lt;-</span> rep(<span class="dv">0</span>, vertices_length(g))</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>ctx <span class="op">&lt;-</span> distribution_context(g,<span class="dv">1000</span>)</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (distribution_context_state(ctx)$cdf <span class="op">&lt;</span> <span class="fl">0.9999</span>) {</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>  distribution_context_step(ctx)</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>expected_visits <span class="op">&lt;-</span> distribution_context_accumulated_visiting_time(ctx)</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>distribution_expectation <span class="op">&lt;-</span> matrix(nrow<span class="op">=</span>n1<span class="op">+</span><span class="dv">1</span>,ncol<span class="op">=</span>n2<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>algorithm_expectation <span class="op">&lt;-</span> matrix(nrow<span class="op">=</span>n1<span class="op">+</span><span class="dv">1</span>,ncol<span class="op">=</span>n2<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>matrix_expectation <span class="op">&lt;-</span> matrix(nrow<span class="op">=</span>n1<span class="op">+</span><span class="dv">1</span>,ncol<span class="op">=</span>n2<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>simulation_expectation <span class="op">&lt;-</span> matrix(nrow<span class="op">=</span>n1<span class="op">+</span><span class="dv">1</span>,ncol<span class="op">=</span>n2<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>PH <span class="op">&lt;-</span> graph_as_matrix(g)</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>U <span class="op">&lt;-</span> solve(<span class="op">-</span>PH$SIM)</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>.seed(<span class="dv">1234</span>)</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="kw">in</span> <span class="dv">0</span>:n1) {</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="kw">in</span> <span class="dv">0</span>:n2) {</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>    matrix_expectation[i<span class="op">+</span><span class="dv">1</span>,j<span class="op">+</span><span class="dv">1</span>] <span class="op">&lt;-</span>PH$IPV <span class="op">%*%</span> U<span class="op">%*%</span>diag(PH$states[,(matrix_index(i,j,<span class="dv">0</span>,n1,n2)<span class="op">+</span><span class="dv">1</span>)]<span class="op">+</span>PH$states[,(matrix_index(i,j,<span class="dv">1</span>,n1,n2)<span class="op">+</span><span class="dv">1</span>)])<span class="op">%*%</span>rep(<span class="dv">1</span>,length(PH$IPV))</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>    algorithm_expectation[i<span class="op">+</span><span class="dv">1</span>, j<span class="op">+</span><span class="dv">1</span>]<span class="op">&lt;-</span> expectation(g, rewards_at(g, i,j,n1,n2))</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>    distribution_expectation[i<span class="op">+</span><span class="dv">1</span>,j<span class="op">+</span><span class="dv">1</span>] <span class="op">&lt;-</span> <span class="bu">sum</span>(expected_visits <span class="op">*</span> rewards_at(g, i,j,n1,n2))</span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>    simulation_expectation[i<span class="op">+</span><span class="dv">1</span>, j<span class="op">+</span><span class="dv">1</span>]<span class="op">&lt;-</span> mean(rph(<span class="dv">1000000</span>, g, rewards_at(g, i,j,n1,n2)))</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sum</span>(<span class="bu">abs</span>(matrix_expectation <span class="op">-</span> algorithm_expectation)))</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sum</span>(<span class="bu">abs</span>(matrix_expectation <span class="op">-</span> simulation_expectation)))</span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sum</span>(<span class="bu">abs</span>(matrix_expectation <span class="op">-</span> distribution_expectation)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.160939e-15
[1] 0.04211939
[1] 0.001238273</code></pre>
</div>
</div>
<div id="532b346d" class="cell" data-execution_count="61">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(matrix_expectation <span class="op">-</span> distribution_expectation, cmap<span class="op">=</span><span class="st">"viridis_r"</span>, </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>                annot<span class="op">=</span><span class="va">True</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-57-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="showcase_files/figure-html/cell-57-output-1.png" width="428" height="305" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>The complete IM model with a split time and ancestral population:</p>
<div id="703e6431-eaa5-45d2-8ea2-42874001f5f9" class="cell" data-execution_count="62">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>n1 <span class="op">&lt;-</span> <span class="dv">7</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>n2 <span class="op">&lt;-</span> <span class="dv">7</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">&lt;-</span> <span class="dv">1</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>m2 <span class="op">&lt;-</span> <span class="dv">1</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>split_t <span class="op">&lt;-</span> <span class="fl">1.5</span> <span class="co"># time in whatever unit used to scale transition probs (N generations)</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="co"># build im graph</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>im_g <span class="op">&lt;-</span> construct_im_graph(n1,n2,<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>)</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>cat(vertices_length(im_g), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create ancestral graph</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>a_g <span class="op">&lt;-</span> construct_ancestral_graph(n1,n2)</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>cat(vertices_length(a_g), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>123135 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>R[write to console]: Fejl i construct_ancestral_graph(n1, n2) : 
  argument "pop_size" is missing, with no default
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Fejl i construct_ancestral_graph(n1, n2) : 
  argument "pop_size" is missing, with no default</code></pre>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RRuntimeError</span>                             Traceback (most recent call last)
File <span class="ansi-green-fg">~/miniconda3/envs/phasetypes/lib/python3.9/site-packages/rpy2/ipython/rmagic.py:268</span>, in <span class="ansi-cyan-fg">RMagics.eval</span><span class="ansi-blue-fg">(self, code)</span>
<span class="ansi-green-fg ansi-bold">    266</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg ansi-bold">    267</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Need the newline in case the last line in code is a comment.</span>
<span class="ansi-green-fg">--&gt; 268</span>     value, visible <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">ro</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">r</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">"</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">withVisible(</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">{</span><span style="font-weight:bold;color:rgb(175,95,135)" class="ansi-yellow-bg">%s</span><span style="font-weight:bold;color:rgb(175,95,0)" class="ansi-yellow-bg">\n</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">})</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">"</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">%</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">code</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    269</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> (ri<span style="color:rgb(98,98,98)">.</span>embedded<span style="color:rgb(98,98,98)">.</span>RRuntimeError, <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>) <span style="font-weight:bold;color:rgb(0,135,0)">as</span> exception:
<span class="ansi-green-fg ansi-bold">    270</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Otherwise next return seems to have copy of error.</span>

File <span class="ansi-green-fg">~/miniconda3/envs/phasetypes/lib/python3.9/site-packages/rpy2/robjects/__init__.py:438</span>, in <span class="ansi-cyan-fg">R.__call__</span><span class="ansi-blue-fg">(self, string)</span>
<span class="ansi-green-fg ansi-bold">    437</span> p <span style="color:rgb(98,98,98)">=</span> rinterface<span style="color:rgb(98,98,98)">.</span>parse(string)
<span class="ansi-green-fg">--&gt; 438</span> res <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">eval</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">p</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    439</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> conversion<span style="color:rgb(98,98,98)">.</span>rpy2py(res)

File <span class="ansi-green-fg">~/miniconda3/envs/phasetypes/lib/python3.9/site-packages/rpy2/robjects/functions.py:198</span>, in <span class="ansi-cyan-fg">SignatureTranslatedFunction.__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    197</span>         kwargs[r_k] <span style="color:rgb(98,98,98)">=</span> v
<span class="ansi-green-fg">--&gt; 198</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> (<span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">SignatureTranslatedFunction</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    199</span> <span class="ansi-yellow-bg">        </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span style="color:rgb(0,0,255)" class="ansi-yellow-bg">__call__</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>)

File <span class="ansi-green-fg">~/miniconda3/envs/phasetypes/lib/python3.9/site-packages/rpy2/robjects/functions.py:125</span>, in <span class="ansi-cyan-fg">Function.__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    124</span>         new_kwargs[k] <span style="color:rgb(98,98,98)">=</span> conversion<span style="color:rgb(98,98,98)">.</span>py2rpy(v)
<span class="ansi-green-fg">--&gt; 125</span> res <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">Function</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">)</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span style="color:rgb(0,0,255)" class="ansi-yellow-bg">__call__</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">new_args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">new_kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    126</span> res <span style="color:rgb(98,98,98)">=</span> conversion<span style="color:rgb(98,98,98)">.</span>rpy2py(res)

File <span class="ansi-green-fg">~/miniconda3/envs/phasetypes/lib/python3.9/site-packages/rpy2/rinterface_lib/conversion.py:45</span>, in <span class="ansi-cyan-fg">_cdata_res_to_rinterface.&lt;locals&gt;._</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">     44</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">_</span>(<span style="color:rgb(98,98,98)">*</span>args, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs):
<span class="ansi-green-fg">---&gt; 45</span>     cdata <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">function</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">     46</span>     <span style="font-style:italic;color:rgb(95,135,135)"># TODO: test cdata is of the expected CType</span>

File <span class="ansi-green-fg">~/miniconda3/envs/phasetypes/lib/python3.9/site-packages/rpy2/rinterface.py:680</span>, in <span class="ansi-cyan-fg">SexpClosure.__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    679</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> error_occured[<span style="color:rgb(98,98,98)">0</span>]:
<span class="ansi-green-fg">--&gt; 680</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> embedded<span style="color:rgb(98,98,98)">.</span>RRuntimeError(_rinterface<span style="color:rgb(98,98,98)">.</span>_geterrmessage())
<span class="ansi-green-fg ansi-bold">    681</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> res

<span class="ansi-red-fg">RRuntimeError</span>: Fejl i construct_ancestral_graph(n1, n2) : 
  argument "pop_size" is missing, with no default


During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">RInterpreterError</span>                         Traceback (most recent call last)
File <span class="ansi-green-fg">&lt;timed eval&gt;:1</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>

File <span class="ansi-green-fg">~/miniconda3/envs/phasetypes/lib/python3.9/site-packages/IPython/core/interactiveshell.py:2257</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg ansi-bold">   2255</span> <span style="font-weight:bold;color:rgb(0,135,0)">with</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>builtin_trap:
<span class="ansi-green-fg ansi-bold">   2256</span>     args <span style="color:rgb(98,98,98)">=</span> (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; 2257</span>     result <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   2258</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> result

File <span class="ansi-green-fg">~/miniconda3/envs/phasetypes/lib/python3.9/site-packages/rpy2/ipython/rmagic.py:783</span>, in <span class="ansi-cyan-fg">RMagics.R</span><span class="ansi-blue-fg">(self, line, cell, local_ns)</span>
<span class="ansi-green-fg ansi-bold">    781</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> e<span style="color:rgb(98,98,98)">.</span>stdout<span style="color:rgb(98,98,98)">.</span>endswith(e<span style="color:rgb(98,98,98)">.</span>err):
<span class="ansi-green-fg ansi-bold">    782</span>         <span style="color:rgb(0,135,0)">print</span>(e<span style="color:rgb(98,98,98)">.</span>err)
<span class="ansi-green-fg">--&gt; 783</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> e
<span class="ansi-green-fg ansi-bold">    784</span> <span style="font-weight:bold;color:rgb(0,135,0)">finally</span>:
<span class="ansi-green-fg ansi-bold">    785</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>device <span style="font-weight:bold;color:rgb(175,0,255)">in</span> [<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">png</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">svg</span><span style="color:rgb(175,0,0)">'</span>]:

File <span class="ansi-green-fg">~/miniconda3/envs/phasetypes/lib/python3.9/site-packages/rpy2/ipython/rmagic.py:763</span>, in <span class="ansi-cyan-fg">RMagics.R</span><span class="ansi-blue-fg">(self, line, cell, local_ns)</span>
<span class="ansi-green-fg ansi-bold">    761</span>         return_output <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">False</span>
<span class="ansi-green-fg ansi-bold">    762</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">--&gt; 763</span>     text_result, result, visible <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">eval</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">code</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    764</span>     text_output <span style="color:rgb(98,98,98)">+</span><span style="color:rgb(98,98,98)">=</span> text_result
<span class="ansi-green-fg ansi-bold">    765</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> visible:

File <span class="ansi-green-fg">~/miniconda3/envs/phasetypes/lib/python3.9/site-packages/rpy2/ipython/rmagic.py:272</span>, in <span class="ansi-cyan-fg">RMagics.eval</span><span class="ansi-blue-fg">(self, code)</span>
<span class="ansi-green-fg ansi-bold">    269</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> (ri<span style="color:rgb(98,98,98)">.</span>embedded<span style="color:rgb(98,98,98)">.</span>RRuntimeError, <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>) <span style="font-weight:bold;color:rgb(0,135,0)">as</span> exception:
<span class="ansi-green-fg ansi-bold">    270</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Otherwise next return seems to have copy of error.</span>
<span class="ansi-green-fg ansi-bold">    271</span>     warning_or_other_msg <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>flush()
<span class="ansi-green-fg">--&gt; 272</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> RInterpreterError(code, <span style="color:rgb(0,135,0)">str</span>(exception),
<span class="ansi-green-fg ansi-bold">    273</span>                             warning_or_other_msg)
<span class="ansi-green-fg ansi-bold">    274</span> text_output <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>flush()
<span class="ansi-green-fg ansi-bold">    275</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> text_output, value, visible[<span style="color:rgb(98,98,98)">0</span>]

<span class="ansi-red-fg">RInterpreterError</span>: Failed to parse and evaluate line '\n# parameters\nn1 &lt;- 7\nn2 &lt;- 7\nm1 &lt;- 1\nm2 &lt;- 1\nsplit_t &lt;- 1.5 # time in whatever unit used to scale transition probs (N generations)\n\n# build im graph\nim_g &lt;- construct_im_graph(n1,n2,1,1,0.1,0.1)\ncat(vertices_length(im_g), "\\n")\n\n# create ancestral graph\na_g &lt;- construct_ancestral_graph(n1,n2)\ncat(vertices_length(a_g), "\\n")\n'.
R error message: 'Fejl i construct_ancestral_graph(n1, n2) : \n  argument "pop_size" is missing, with no default'</pre>
</div>
</div>
</div>
<div id="c34789c9" class="cell" data-execution_count="63">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o n1 <span class="op">-</span>o n2 <span class="op">-</span>o m1 <span class="op">-</span>o m2 <span class="op">-</span>o split_t <span class="op">-</span>o im_expectation <span class="op">-</span>o a_expectation</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>n1 <span class="op">&lt;-</span> <span class="dv">7</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>n2 <span class="op">&lt;-</span> <span class="dv">7</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>m12 <span class="op">&lt;-</span> <span class="fl">0.005</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>m21 <span class="op">&lt;-</span> <span class="dv">2</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">&lt;-</span> <span class="dv">2</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">&lt;-</span> <span class="dv">1</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>pa <span class="op">&lt;-</span> <span class="dv">4</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>split_t <span class="op">&lt;-</span> <span class="dv">3</span> <span class="co"># time in whatever unit used to scale transition probs (N generations)</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a><span class="co"># build im graph</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>im_g <span class="op">&lt;-</span> construct_im_graph(n1, n2, p1, p2, m12, m21)</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>cat(vertices_length(im_g), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>im_expected_visits <span class="op">&lt;-</span> accumulated_visiting_time(im_g, split_t)</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a><span class="co"># create ancestral graph</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>a_g <span class="op">&lt;-</span> construct_ancestral_graph(n1, n2, pa)</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>cat(vertices_length(a_g), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a><span class="co"># find probabilities of starting at each state in ancestral graph</span></span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>start_prob <span class="op">&lt;-</span> start_prob_from_im(a_g, im_g, im_expected_visits)</span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a><span class="co"># compute expectations for each graph</span></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>im_expectation <span class="op">&lt;-</span> matrix(nrow<span class="op">=</span>n1<span class="op">+</span><span class="dv">1</span>,ncol<span class="op">=</span>n2<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>a_expectation <span class="op">&lt;-</span> matrix(nrow<span class="op">=</span>n1<span class="op">+</span><span class="dv">1</span>,ncol<span class="op">=</span>n2<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="kw">in</span> <span class="dv">0</span>:n1) {</span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="kw">in</span> <span class="dv">0</span>:n2) {</span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>    im_expectation[i<span class="op">+</span><span class="dv">1</span>,j<span class="op">+</span><span class="dv">1</span>] <span class="op">&lt;-</span> <span class="bu">sum</span>(im_expected_visits <span class="op">*</span> rewards_at(im_g, i,j,n1,n2))</span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>    a_expectation[i<span class="op">+</span><span class="dv">1</span>, j<span class="op">+</span><span class="dv">1</span>]<span class="op">&lt;-</span> <span class="bu">sum</span>(start_prob <span class="op">*</span> expected_waiting_time(a_g, rewards_at(a_g, i,j,n1,n2)))</span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>123135 
2999 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 39 s, sys: 494 ms, total: 39.5 s
Wall time: 40.1 s</code></pre>
</div>
</div>
<div id="5e6cb3a1" class="cell" data-execution_count="64">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(im_expectation).to_hdf(<span class="ss">f'im_</span><span class="sc">{</span><span class="bu">int</span>(n1)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span><span class="bu">int</span>(n2)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span><span class="bu">float</span>(m1)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span><span class="bu">float</span>(m2)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span><span class="bu">float</span>(split_t)<span class="sc">}</span><span class="ss">.h5'</span>, key<span class="op">=</span><span class="st">'df'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'table'</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(a_expectation).to_hdf(<span class="ss">f'a_</span><span class="sc">{</span><span class="bu">int</span>(n1)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span><span class="bu">int</span>(n2)<span class="sc">}</span><span class="ss">.h5'</span>, key<span class="op">=</span><span class="st">'df'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'table'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Expectation for inifinte IM stage:</p>
<div id="0e98902d" class="cell" data-execution_count="65">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(pd.DataFrame(im_expectation), cmap<span class="op">=</span><span class="st">"viridis_r"</span>, </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                annot=True</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'im_stage.pdf'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-61-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="showcase_files/figure-html/cell-61-output-1.png" width="404" height="305" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Expectation for panmictic ancestral population:</p>
<div id="6f52c596" class="cell" data-execution_count="66">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(a_expectation, cmap<span class="op">=</span><span class="st">"viridis_r"</span>, </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                annot=True</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'a_stage.pdf'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-62-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="showcase_files/figure-html/cell-62-output-1.png" width="404" height="305" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Expectation for combined IM model with split time:</p>
<div id="caacdd27" class="cell" data-execution_count="67">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(im_expectation <span class="op">+</span> a_expectation, cmap<span class="op">=</span><span class="st">"viridis_r"</span>, </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>                <span class="co"># annot=True,</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>                 linewidths<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>                 linecolor<span class="op">=</span><span class="st">'white'</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig(f"figures/im_{n1}_{n1}_{m1}_{m2}_{split_t}.pdf")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-63-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="showcase_files/figure-html/cell-63-output-1.png" width="395" height="305" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="4820fa20" class="cell" data-execution_count="68">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">7</span>))</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(im_expectation <span class="op">+</span> a_expectation, cmap<span class="op">=</span><span class="st">"viridis_r"</span>, </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>                annot<span class="op">=</span><span class="va">True</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-64-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="showcase_files/figure-html/cell-64-output-1.png" width="495" height="414" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<section id="model-with-two-loci-two-islands-with-samples-from-one-population" class="level2">
<h2 class="anchored" data-anchor-id="model-with-two-loci-two-islands-with-samples-from-one-population">Model with two loci, two islands, with samples from one population</h2>
<p>Each state has the following three properties: 1. nr decendants at locus 1 2. nr decendants at locus 2 3. what population the lineage is currently in</p>
<div id="51053397-72b4-4946-9d3e-52afa36db4b4" class="cell" data-execution_count="69">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>Rcpp::sourceCpp(<span class="st">"./two_locus_two_island.cpp"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>ld: warning: -pie being ignored. It is only used when linking a main executable</code></pre>
</div>
</div>
<div id="c02561ee-aad0-485b-9a72-8a1b8b1086b6" class="cell" data-tags="[]" data-execution_count="70">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%R</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co"># setClass("conf", slots=list(locus1="numeric", locus2="numeric", population="numeric"))</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="co"># obj &lt;- new("conf", locus1=3, locus2=2, population=1)</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="co"># obj@population</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r_index_to_props &lt;- function(s, i) {</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     #' returns the locus1, locus2, population</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     #' conformation of lineages represented by</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     #' state vector index i.</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     stopifnot(i &gt; 0)</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     d &lt;- s + 1 # dim</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     idx &lt;- i - 1</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     p &lt;- idx %/% d**2</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     stopifnot(i &lt;= 2*d**2)</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     a &lt;- (idx - p*d**2) %/% d</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     b &lt;- (idx - p*d**2) %% d</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     return(new("conf", locus1=a, locus2=b, population=p+1))</span></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a><span class="co"># r_props_to_index &lt;- function(s, a, b, p) {</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     #' returns the state vector index representing</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     #' the locus1, locus2, population conformation.</span></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     d &lt;- s + 1</span></span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     i = (p-1)*d**2 + a*d + b + 1</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     return(i)</span></span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="ff60bc1b-c18f-42e4-97e7-79585023cb5c" class="cell" data-tags="[]" data-execution_count="71">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%R</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="co"># n &lt;- 2</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for (p in 1:2) {</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     for (i in 0:n) {</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         for (j in 0:n) {</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             print(props_to_index(n, i, j, p))</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="co">#             print(r_props_to_index(n, i, j, p))</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co">#         }</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     }</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="d2bea293-06ce-4748-bafc-fde0a1fb52bf" class="cell" data-execution_count="72">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o s</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>s <span class="op">&lt;-</span> <span class="dv">6</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>N <span class="op">&lt;-</span> <span class="dv">1</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>M <span class="op">&lt;-</span> <span class="dv">0</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>R <span class="op">&lt;-</span> <span class="dv">1</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>tli_graph <span class="op">&lt;-</span> construct_twolocus_island_graph(s, N, M, R)</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vertices_length(tli_graph))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1044
CPU times: user 89.9 ms, sys: 5.22 ms, total: 95.2 ms
Wall time: 93.1 ms</code></pre>
</div>
</div>
<div id="469878da-d0ad-424e-a3e9-306a640de4d2" class="cell" data-execution_count="73">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o outgoing_edge_counts</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>si <span class="op">&lt;-</span> sign(graph_as_matrix(tli_graph)$SIM)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>diag(si) <span class="op">&lt;-</span> <span class="dv">0</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>outgoing_edge_counts <span class="op">&lt;-</span> rowSums(si)</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mean(outgoing_edge_counts))</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="co"># qplot(outgoing_edge_counts, bins=100, asp=1)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.74856</code></pre>
</div>
</div>
<div id="aad5ee5c-1e88-47b2-9ad2-1d3d657a3656" class="cell" data-execution_count="74">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>plt.hist(outgoing_edge_counts, bins<span class="op">=</span><span class="dv">100</span>) <span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-70-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="showcase_files/figure-html/cell-70-output-1.png" width="377" height="251" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="0cf2cf4f-dbc4-4caa-bc4c-c4a884f2d91e" class="cell" data-execution_count="75">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>expectation(tli_graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.220418
CPU times: user 21.1 ms, sys: 6.65 ms, total: 27.8 ms
Wall time: 24 ms</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
</div>
<div id="13c4dde7-54f0-4afa-9de7-4d46c529fb20" class="cell" data-execution_count="76">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%time</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co"># %%R</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="co"># graph_update_weights_parameterized(tli_graph, c(1, 1, 1))</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="co"># expectation(tli_graph)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="dbd868de-f31c-49dd-b1a7-2dd30603a8da" class="cell" data-tags="[]" data-execution_count="77">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%R -o graph -o states -o ipv -o sim</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ###########################</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # sample size</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co"># s &lt;- 2</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ###########################</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # number of populations</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co"># p &lt;- 2 # needs to be 2</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # state vector length</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="co"># n &lt;- p*(s+1)**2</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="co"># graph &lt;- create_graph(n)</span></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a><span class="co"># index &lt;- 1</span></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # first_vertex &lt;- create_vertex(graph, c(rep(0, s+2), s, rep(0, n-s-3))) # assumes that p=2</span></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a><span class="co"># state &lt;- rep(0, n)</span></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a><span class="co"># state[conf_to_index(s, 1, 1, 1)] &lt;- s</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a><span class="co"># first_vertex &lt;- create_vertex(graph, state) # assumes that p=2</span></span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a><span class="co"># add_edge(starting_vertex(graph), first_vertex, 1)</span></span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a><span class="co"># index &lt;- 2</span></span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a><span class="co"># while (index &lt;= vertices_length(graph)) {</span></span>
<span id="cb126-23"><a href="#cb126-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-24"><a href="#cb126-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   vertex &lt;- vertex_at(graph, index)</span></span>
<span id="cb126-25"><a href="#cb126-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   state &lt;- vertex$state</span></span>
<span id="cb126-26"><a href="#cb126-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb126-27"><a href="#cb126-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   count &lt;- 0</span></span>
<span id="cb126-28"><a href="#cb126-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   for (i in 1:n) {</span></span>
<span id="cb126-29"><a href="#cb126-29" aria-hidden="true" tabindex="-1"></a><span class="co">#       count &lt;- count + state[i]</span></span>
<span id="cb126-30"><a href="#cb126-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb126-31"><a href="#cb126-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (count &lt;= 1) {</span></span>
<span id="cb126-32"><a href="#cb126-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       # Only one lineage, stop</span></span>
<span id="cb126-33"><a href="#cb126-33" aria-hidden="true" tabindex="-1"></a><span class="co">#       index &lt;- index + 1</span></span>
<span id="cb126-34"><a href="#cb126-34" aria-hidden="true" tabindex="-1"></a><span class="co">#       next</span></span>
<span id="cb126-35"><a href="#cb126-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   }    </span></span>
<span id="cb126-36"><a href="#cb126-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-37"><a href="#cb126-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   for (i in 1:n) {</span></span>
<span id="cb126-38"><a href="#cb126-38" aria-hidden="true" tabindex="-1"></a><span class="co">#     conf_i &lt;- index_to_conf(s, i)</span></span>
<span id="cb126-39"><a href="#cb126-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-40"><a href="#cb126-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     # coalescence #########################</span></span>
<span id="cb126-41"><a href="#cb126-41" aria-hidden="true" tabindex="-1"></a><span class="co">#     for (j in i:n) {</span></span>
<span id="cb126-42"><a href="#cb126-42" aria-hidden="true" tabindex="-1"></a><span class="co">#       conf_j &lt;- index_to_conf(s, j)</span></span>
<span id="cb126-43"><a href="#cb126-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-44"><a href="#cb126-44" aria-hidden="true" tabindex="-1"></a><span class="co">#       if (conf_i@population != conf_j@population) {</span></span>
<span id="cb126-45"><a href="#cb126-45" aria-hidden="true" tabindex="-1"></a><span class="co">#         # different populations</span></span>
<span id="cb126-46"><a href="#cb126-46" aria-hidden="true" tabindex="-1"></a><span class="co">#         next</span></span>
<span id="cb126-47"><a href="#cb126-47" aria-hidden="true" tabindex="-1"></a><span class="co">#       }</span></span>
<span id="cb126-48"><a href="#cb126-48" aria-hidden="true" tabindex="-1"></a><span class="co">#       if (i == j) {</span></span>
<span id="cb126-49"><a href="#cb126-49" aria-hidden="true" tabindex="-1"></a><span class="co">#         if (state[i] &lt; 2) {</span></span>
<span id="cb126-50"><a href="#cb126-50" aria-hidden="true" tabindex="-1"></a><span class="co">#           next;</span></span>
<span id="cb126-51"><a href="#cb126-51" aria-hidden="true" tabindex="-1"></a><span class="co">#         }</span></span>
<span id="cb126-52"><a href="#cb126-52" aria-hidden="true" tabindex="-1"></a><span class="co">#         rate &lt;- state[i] * (state[i] - 1) / 2</span></span>
<span id="cb126-53"><a href="#cb126-53" aria-hidden="true" tabindex="-1"></a><span class="co">#       } else {</span></span>
<span id="cb126-54"><a href="#cb126-54" aria-hidden="true" tabindex="-1"></a><span class="co">#         if (state[i] &lt; 1 || state[j] &lt; 1) {</span></span>
<span id="cb126-55"><a href="#cb126-55" aria-hidden="true" tabindex="-1"></a><span class="co">#           next;</span></span>
<span id="cb126-56"><a href="#cb126-56" aria-hidden="true" tabindex="-1"></a><span class="co">#         }</span></span>
<span id="cb126-57"><a href="#cb126-57" aria-hidden="true" tabindex="-1"></a><span class="co">#         rate &lt;- state[i] * state[j]</span></span>
<span id="cb126-58"><a href="#cb126-58" aria-hidden="true" tabindex="-1"></a><span class="co">#       }</span></span>
<span id="cb126-59"><a href="#cb126-59" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-60"><a href="#cb126-60" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state &lt;- state</span></span>
<span id="cb126-61"><a href="#cb126-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb126-62"><a href="#cb126-62" aria-hidden="true" tabindex="-1"></a><span class="co">#       # lineages with index i and j coalesce:  </span></span>
<span id="cb126-63"><a href="#cb126-63" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state[i] &lt;- child_state[i] - 1</span></span>
<span id="cb126-64"><a href="#cb126-64" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state[j] &lt;- child_state[j] - 1</span></span>
<span id="cb126-65"><a href="#cb126-65" aria-hidden="true" tabindex="-1"></a><span class="co">#       stopifnot(conf_i@locus1+conf_j@locus1 &lt;= s)</span></span>
<span id="cb126-66"><a href="#cb126-66" aria-hidden="true" tabindex="-1"></a><span class="co">#       stopifnot(conf_i@locus2+conf_j@locus2 &lt;= s)</span></span>
<span id="cb126-67"><a href="#cb126-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-68"><a href="#cb126-68" aria-hidden="true" tabindex="-1"></a><span class="co">#       # coalescene into lineage with index k</span></span>
<span id="cb126-69"><a href="#cb126-69" aria-hidden="true" tabindex="-1"></a><span class="co">#       k = conf_to_index(s, conf_i@locus1+conf_j@locus1, conf_i@locus2+conf_j@locus2, conf_i@population)</span></span>
<span id="cb126-70"><a href="#cb126-70" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state[k] &lt;- child_state[k] + 1</span></span>
<span id="cb126-71"><a href="#cb126-71" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-72"><a href="#cb126-72" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_vertex &lt;- find_or_create_vertex(graph, child_state)</span></span>
<span id="cb126-73"><a href="#cb126-73" aria-hidden="true" tabindex="-1"></a><span class="co">#       add_edge(vertex, child_vertex, rate)</span></span>
<span id="cb126-74"><a href="#cb126-74" aria-hidden="true" tabindex="-1"></a><span class="co">#     }</span></span>
<span id="cb126-75"><a href="#cb126-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-76"><a href="#cb126-76" aria-hidden="true" tabindex="-1"></a><span class="co">#     # recombination #######################</span></span>
<span id="cb126-77"><a href="#cb126-77" aria-hidden="true" tabindex="-1"></a><span class="co">#     if (state[i] &gt; 0 &amp;&amp; conf_i@locus1 &gt; 0 &amp;&amp; conf_i@locus2 &gt; 0) {</span></span>
<span id="cb126-78"><a href="#cb126-78" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-79"><a href="#cb126-79" aria-hidden="true" tabindex="-1"></a><span class="co">#       rate &lt;- 3</span></span>
<span id="cb126-80"><a href="#cb126-80" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state &lt;- state</span></span>
<span id="cb126-81"><a href="#cb126-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb126-82"><a href="#cb126-82" aria-hidden="true" tabindex="-1"></a><span class="co">#       # a lineage with index i recombines to produce lineages with index k and l</span></span>
<span id="cb126-83"><a href="#cb126-83" aria-hidden="true" tabindex="-1"></a><span class="co">#       k = conf_to_index(s, conf_i@locus1, 0, conf_i@population)</span></span>
<span id="cb126-84"><a href="#cb126-84" aria-hidden="true" tabindex="-1"></a><span class="co">#       l = conf_to_index(s, 0, conf_i@locus2, conf_i@population)</span></span>
<span id="cb126-85"><a href="#cb126-85" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state[i] &lt;- child_state[i] - 1</span></span>
<span id="cb126-86"><a href="#cb126-86" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state[k] &lt;- child_state[k] + 1</span></span>
<span id="cb126-87"><a href="#cb126-87" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state[l] &lt;- child_state[l] + 1</span></span>
<span id="cb126-88"><a href="#cb126-88" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-89"><a href="#cb126-89" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_vertex &lt;- find_or_create_vertex(graph, child_state)</span></span>
<span id="cb126-90"><a href="#cb126-90" aria-hidden="true" tabindex="-1"></a><span class="co">#       add_edge(vertex, child_vertex, rate)</span></span>
<span id="cb126-91"><a href="#cb126-91" aria-hidden="true" tabindex="-1"></a><span class="co">#     }</span></span>
<span id="cb126-92"><a href="#cb126-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-93"><a href="#cb126-93" aria-hidden="true" tabindex="-1"></a><span class="co">#     # migration ###########################</span></span>
<span id="cb126-94"><a href="#cb126-94" aria-hidden="true" tabindex="-1"></a><span class="co">#     if (state[i] &gt; 0) {</span></span>
<span id="cb126-95"><a href="#cb126-95" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-96"><a href="#cb126-96" aria-hidden="true" tabindex="-1"></a><span class="co">#       rate &lt;- 0.001</span></span>
<span id="cb126-97"><a href="#cb126-97" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state &lt;- state</span></span>
<span id="cb126-98"><a href="#cb126-98" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb126-99"><a href="#cb126-99" aria-hidden="true" tabindex="-1"></a><span class="co">#       if (conf_i@population == 1) {</span></span>
<span id="cb126-100"><a href="#cb126-100" aria-hidden="true" tabindex="-1"></a><span class="co">#         m = 2</span></span>
<span id="cb126-101"><a href="#cb126-101" aria-hidden="true" tabindex="-1"></a><span class="co">#       } else {</span></span>
<span id="cb126-102"><a href="#cb126-102" aria-hidden="true" tabindex="-1"></a><span class="co">#         m = 1</span></span>
<span id="cb126-103"><a href="#cb126-103" aria-hidden="true" tabindex="-1"></a><span class="co">#       }</span></span>
<span id="cb126-104"><a href="#cb126-104" aria-hidden="true" tabindex="-1"></a><span class="co">#       # </span></span>
<span id="cb126-105"><a href="#cb126-105" aria-hidden="true" tabindex="-1"></a><span class="co">#       k = conf_to_index(s, conf_i@locus1, conf_i@locus2, m)</span></span>
<span id="cb126-106"><a href="#cb126-106" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state[i] &lt;- child_state[i] - 1</span></span>
<span id="cb126-107"><a href="#cb126-107" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_state[k] &lt;- child_state[k] + 1</span></span>
<span id="cb126-108"><a href="#cb126-108" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-109"><a href="#cb126-109" aria-hidden="true" tabindex="-1"></a><span class="co">#       child_vertex &lt;- find_or_create_vertex(graph, child_state)</span></span>
<span id="cb126-110"><a href="#cb126-110" aria-hidden="true" tabindex="-1"></a><span class="co">#       add_edge(vertex, child_vertex, rate)</span></span>
<span id="cb126-111"><a href="#cb126-111" aria-hidden="true" tabindex="-1"></a><span class="co">#     }</span></span>
<span id="cb126-112"><a href="#cb126-112" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb126-113"><a href="#cb126-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb126-114"><a href="#cb126-114" aria-hidden="true" tabindex="-1"></a><span class="co">#   index &lt;- index + 1</span></span>
<span id="cb126-115"><a href="#cb126-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-116"><a href="#cb126-116" aria-hidden="true" tabindex="-1"></a><span class="co">#   if ((index %% 50) == 0) {</span></span>
<span id="cb126-117"><a href="#cb126-117" aria-hidden="true" tabindex="-1"></a><span class="co">#     cat(index, vertices_length(graph), "\n")</span></span>
<span id="cb126-118"><a href="#cb126-118" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb126-119"><a href="#cb126-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-120"><a href="#cb126-120" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb126-121"><a href="#cb126-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-122"><a href="#cb126-122" aria-hidden="true" tabindex="-1"></a><span class="co"># states &lt;- t(sapply(1:vertices_length(graph), function(index) vertex_at(graph, index)$state, simplify = FALSE))</span></span>
<span id="cb126-123"><a href="#cb126-123" aria-hidden="true" tabindex="-1"></a><span class="co"># ipv &lt;- graph_as_matrix(graph)$IPV</span></span>
<span id="cb126-124"><a href="#cb126-124" aria-hidden="true" tabindex="-1"></a><span class="co"># sim &lt;- graph_as_matrix(graph)$SIM</span></span>
<span id="cb126-125"><a href="#cb126-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-126"><a href="#cb126-126" aria-hidden="true" tabindex="-1"></a><span class="co"># graph_as_matrix(graph)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="05b8332c" class="cell" data-execution_count="78">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>rewards <span class="op">&lt;-</span> sapply(<span class="dv">1</span>:vertices_length(tli_graph), function(index) vertex_at(tli_graph, index)$state )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="varying-population-size-in-epoques" class="level3">
<h3 class="anchored" data-anchor-id="varying-population-size-in-epoques">Varying population size in epoques</h3>
<div id="42aea87e-6a0c-4f1c-8751-861b020a0a93" class="cell" data-tags="[]" data-execution_count="79">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%time</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co"># %%R -o n1 -o n2 -o m1 -o m2 -o split_t -o im_expectation -o a_expectation</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # parameters</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co"># n &lt;- 10</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # graphs with paramerized N</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="co"># g &lt;- kingman(n)</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="co"># expectation &lt;- matrix(nrow=n1+1,ncol=n2+1)</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="co"># prev_t &lt;- 0</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="co"># epoque_start_prob &lt;- c(1,0,0,0...)</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="co"># for (t in 1:5) {</span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     rescale_...</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     epoque_expected_visits &lt;- accumulated_visiting_time(g, t-prev_t)</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     for (i in 0:n1) {</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a><span class="co">#       for (j in 0:n2) {</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="co">#         expectation[i+1,j+1] &lt;- expectation[i+1,j+1] + sum(epoque_start_prob * epoque_expected_visits * rewards_at(im_g, i,j,n1,n2))</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a><span class="co">#       }</span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     }</span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     epoque_start_prob &lt;- epoque_expected_visits</span></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     prev_t &lt;- 1</span></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="two-locus-sfs-for-a-two-island-model" class="level3">
<h3 class="anchored" data-anchor-id="two-locus-sfs-for-a-two-island-model">Two-locus SFS for a two-island model</h3>
<p>Expected ARG branches with i and j tons from each locus</p>
<div id="e12d0596-fbf4-4ead-b5e7-32d88392d0a7" class="cell" data-execution_count="80">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o exp_mat</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>exp_mat <span class="op">&lt;-</span> matrix(nrow<span class="op">=</span>s<span class="op">-</span><span class="dv">1</span>,ncol<span class="op">=</span>s<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="kw">in</span> <span class="dv">1</span>:s<span class="op">-</span><span class="dv">1</span>) {</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="kw">in</span> <span class="dv">1</span>:s<span class="op">-</span><span class="dv">1</span>) {</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    exp_mat[i,j] <span class="op">&lt;-</span> expectation(tli_graph, rewards[props_to_index(s, i, j, <span class="dv">1</span>),] <span class="op">+</span> rewards[props_to_index(s, i, j, <span class="dv">2</span>),])</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="d60b8ef8-4bcf-4c17-9e78-e7ca7451f43d" class="cell" data-execution_count="81">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.subplots(1, 1, figsize=(7, 5))</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ax = sns.heatmap(exp_mat, cmap="PiYG", </span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                  center=0,</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                 annot=True</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                 )</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.invert_yaxis()</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">int</span>(s)))</span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(exp_mat, cmap<span class="op">=</span><span class="st">"PiYG"</span>, </span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>                 center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>                yticklabels<span class="op">=</span>ticks,</span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>                xticklabels<span class="op">=</span>ticks,</span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>                annot<span class="op">=</span><span class="va">True</span></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-77-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="showcase_files/figure-html/cell-77-output-1.png" width="404" height="305" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="marginal-sfss-for-each-locus" class="level3">
<h3 class="anchored" data-anchor-id="marginal-sfss-for-each-locus">Marginal SFSs for each locus</h3>
<div id="a059e123-f70c-4670-a746-3e5a41a8b489" class="cell" data-execution_count="82">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o sfs_locus1 <span class="op">-</span>o sfs_locus2</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>sfs_locus1 <span class="op">&lt;-</span> colSums(exp_mat)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>sfs_locus2 <span class="op">&lt;-</span> rowSums(exp_mat)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="eb42def2-792e-486a-9476-a3ab8d9528a9" class="cell" data-execution_count="83">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(sfs_locus1)<span class="op">+</span><span class="dv">1</span>)), y<span class="op">=</span>sfs_locus1, ax<span class="op">=</span>axes[<span class="dv">0</span>]).set_title(<span class="st">""</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(sfs_locus2)<span class="op">+</span><span class="dv">1</span>)), y<span class="op">=</span>sfs_locus2, ax<span class="op">=</span>axes[<span class="dv">1</span>]).set_title(<span class="st">""</span>)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>sns.despine()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-79-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="showcase_files/figure-html/cell-79-output-1.png" width="708" height="251" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="covariance-of-arg-branches-in-the-two-populations" class="level3">
<h3 class="anchored" data-anchor-id="covariance-of-arg-branches-in-the-two-populations">Covariance of ARG branches in the two populations</h3>
<p>Covariance of two-locus “ton” branch length (e.g.&nbsp;singletons at locus 1 and doubletons at locus 2) spent in each population.</p>
<div id="1bed4ca0" class="cell" data-execution_count="84">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o cov_mat</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>fun <span class="op">&lt;-</span> function(a, b) mapply(function(i, j) covariance(tli_graph, rewards[props_to_index(s, i, j, <span class="dv">1</span>),], rewards[props_to_index(s, i, j, <span class="dv">2</span>),]), a, b)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>cov_mat <span class="op">&lt;-</span> outer(<span class="dv">1</span>:(s<span class="op">-</span><span class="dv">1</span>), <span class="dv">1</span>:(s<span class="op">-</span><span class="dv">1</span>), fun)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="b3f1b648" class="cell" data-execution_count="85">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">int</span>(s)))</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(cov_mat, cmap<span class="op">=</span><span class="st">"PiYG"</span>, </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>                 center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>                yticklabels<span class="op">=</span>ticks,</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>                xticklabels<span class="op">=</span>ticks,</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>                annot<span class="op">=</span><span class="va">True</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-81-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="showcase_files/figure-html/cell-81-output-1.png" width="423" height="309" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Shows that when there are hte same number of decendants at each locus (mostly becuase of no recombination) then the covariance is highest. Mostly for small tons where there are many lineages to back and forth between popoulations.</p>
</section>
<section id="covriance-between-tons-at-each-locus" class="level3">
<h3 class="anchored" data-anchor-id="covriance-between-tons-at-each-locus">Covriance between tons at each locus</h3>
<div id="c622ea5d-a77f-4379-96f9-46ac5219921b" class="cell" data-execution_count="86">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o cov_mat</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>r_props_to_index <span class="op">&lt;-</span> function(s, a, b, p) {</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>((p<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>(s <span class="op">+</span> <span class="dv">1</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> a<span class="op">*</span>(s <span class="op">+</span> <span class="dv">1</span>) <span class="op">+</span> b <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>locus1_rewards <span class="op">&lt;-</span> function(i) {</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>    colSums(rewards[r_props_to_index(s, i, <span class="dv">1</span>:s, <span class="dv">1</span>),]) <span class="op">+</span> colSums(rewards[r_props_to_index(s, i, <span class="dv">1</span>:s, <span class="dv">2</span>),])</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>locus2_rewards <span class="op">&lt;-</span> function(j) {</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>    colSums(rewards[r_props_to_index(s, <span class="dv">1</span>:s, j, <span class="dv">1</span>),]) <span class="op">+</span> colSums(rewards[r_props_to_index(s, <span class="dv">1</span>:s, j, <span class="dv">2</span>),])</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>fun <span class="op">&lt;-</span> function(a, b) mapply(function(i, j) covariance(tli_graph, locus1_rewards(i), locus2_rewards(j)), a, b)</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>cov_mat <span class="op">&lt;-</span> outer(<span class="dv">1</span>:(s<span class="op">-</span><span class="dv">1</span>), <span class="dv">1</span>:(s<span class="op">-</span><span class="dv">1</span>), fun)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="dcab5610" class="cell" data-execution_count="87">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">int</span>(s)))</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(cov_mat, cmap<span class="op">=</span><span class="st">"PiYG"</span>, </span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>                annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>                center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>                yticklabels<span class="op">=</span>ticks,</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>                xticklabels<span class="op">=</span>ticks</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-83-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="showcase_files/figure-html/cell-83-output-1.png" width="404" height="305" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="8f45463c-60ec-4a3f-9352-35331434ff7c" class="cell" data-execution_count="88">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>tli_graph <span class="op">&lt;-</span> construct_twolocus_island_graph(s, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>rewards <span class="op">&lt;-</span> sapply(<span class="dv">1</span>:vertices_length(tli_graph), function(index) vertex_at(tli_graph, index)$state )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="7a355313-9208-43b1-8b4f-f30061edccaf" class="cell" data-execution_count="89">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o cov_mat</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>r_props_to_index <span class="op">&lt;-</span> function(s, a, b, p) {</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>((p<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>(s <span class="op">+</span> <span class="dv">1</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> a<span class="op">*</span>(s <span class="op">+</span> <span class="dv">1</span>) <span class="op">+</span> b <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>locus1_rewards <span class="op">&lt;-</span> function(i) {</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>    colSums(rewards[r_props_to_index(s, i, <span class="dv">1</span>:s, <span class="dv">1</span>),]) <span class="op">+</span> colSums(rewards[r_props_to_index(s, i, <span class="dv">1</span>:s, <span class="dv">2</span>),])</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>locus2_rewards <span class="op">&lt;-</span> function(j) {</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>    colSums(rewards[r_props_to_index(s, <span class="dv">1</span>:s, j, <span class="dv">1</span>),]) <span class="op">+</span> colSums(rewards[r_props_to_index(s, <span class="dv">1</span>:s, j, <span class="dv">2</span>),])</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>fun <span class="op">&lt;-</span> function(a, b) mapply(function(i, j) covariance(tli_graph, locus1_rewards(i), locus2_rewards(j)), a, b)</span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>cov_mat <span class="op">&lt;-</span> outer(<span class="dv">1</span>:(s<span class="op">-</span><span class="dv">1</span>), <span class="dv">1</span>:(s<span class="op">-</span><span class="dv">1</span>), fun)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
</div>
<div id="c922e452-5055-43d3-ab62-07da70d580c7" class="cell" data-execution_count="90">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">int</span>(s)))</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(cov_mat, cmap<span class="op">=</span><span class="st">"PiYG"</span>, </span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>                annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>                center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>                yticklabels<span class="op">=</span>ticks,</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>                xticklabels<span class="op">=</span>ticks</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-86-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="showcase_files/figure-html/cell-86-output-1.png" width="410" height="305" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="rabbit-model" class="level2">
<h2 class="anchored" data-anchor-id="rabbit-model">Rabbit model</h2>
<div id="3906ff80" class="cell" data-execution_count="91">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Image("../images/rabbitislands.png", width=600)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="2fa02d3b" class="cell" data-execution_count="92">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>Rcpp::sourceCpp(<span class="st">"./rabbit_construction.cpp"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>ld: warning: -pie being ignored. It is only used when linking a main executable</code></pre>
</div>
</div>
<div id="1a4473a8-6ba9-4f30-8189-00f39780f855" class="cell" data-execution_count="93">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>graph <span class="op">&lt;-</span> construct_rabbit_graph(<span class="dv">1000</span>, <span class="dv">4</span>, <span class="dv">2</span>)</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vertices_length(graph))</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>expectation(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 501502</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3056984
CPU times: user 52.3 s, sys: 49.9 s, total: 1min 42s
Wall time: 2min 22s</code></pre>
</div>
</div>
<div id="5baf5633" class="cell" data-execution_count="94">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R <span class="op">-</span>o states <span class="op">-</span>o ipv <span class="op">-</span>o sim</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>L <span class="op">&lt;-</span> <span class="dv">2</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>tim <span class="op">&lt;-</span> proc.time()</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>state_vector_length <span class="op">&lt;-</span> <span class="dv">2</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>graph <span class="op">&lt;-</span> create_graph(state_vector_length)</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>starting_vertex <span class="op">&lt;-</span> vertex_at(graph, <span class="dv">1</span>)</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>initial_state <span class="op">&lt;-</span> c(L, <span class="dv">0</span>)</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>add_edge(</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>  starting_vertex,</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>  create_vertex(graph, initial_state),</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span></span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>index <span class="op">&lt;-</span> <span class="dv">2</span></span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (index <span class="op">&lt;=</span> vertices_length(graph)) {</span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>  vertex <span class="op">&lt;-</span> vertex_at(graph, index)</span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>  state <span class="op">&lt;-</span> vertex$state</span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (state[<span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rabbit jump left to right</span></span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a>    child_state <span class="op">&lt;-</span> c(state[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>, state[<span class="dv">2</span>] <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a>    add_edge(</span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a>      vertex,</span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a>      find_or_create_vertex(graph, child_state),</span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span></span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 0, c(1, 0)</span></span>
<span id="cb148-29"><a href="#cb148-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb148-30"><a href="#cb148-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb148-31"><a href="#cb148-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Island flooding</span></span>
<span id="cb148-32"><a href="#cb148-32" aria-hidden="true" tabindex="-1"></a>    child_state <span class="op">&lt;-</span> c(<span class="dv">0</span>, state[<span class="dv">2</span>])</span>
<span id="cb148-33"><a href="#cb148-33" aria-hidden="true" tabindex="-1"></a>    add_edge(</span>
<span id="cb148-34"><a href="#cb148-34" aria-hidden="true" tabindex="-1"></a>      vertex,</span>
<span id="cb148-35"><a href="#cb148-35" aria-hidden="true" tabindex="-1"></a>      find_or_create_vertex(graph, child_state),</span>
<span id="cb148-36"><a href="#cb148-36" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span></span>
<span id="cb148-37"><a href="#cb148-37" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 0, c(0, 1)</span></span>
<span id="cb148-38"><a href="#cb148-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-39"><a href="#cb148-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb148-40"><a href="#cb148-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb148-41"><a href="#cb148-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-42"><a href="#cb148-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (state[<span class="dv">2</span>] <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb148-43"><a href="#cb148-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rabbit jump right to left</span></span>
<span id="cb148-44"><a href="#cb148-44" aria-hidden="true" tabindex="-1"></a>    child_state <span class="op">&lt;-</span> c(state[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>, state[<span class="dv">2</span>] <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb148-45"><a href="#cb148-45" aria-hidden="true" tabindex="-1"></a>    add_edge(</span>
<span id="cb148-46"><a href="#cb148-46" aria-hidden="true" tabindex="-1"></a>      vertex,</span>
<span id="cb148-47"><a href="#cb148-47" aria-hidden="true" tabindex="-1"></a>      find_or_create_vertex(graph, child_state),</span>
<span id="cb148-48"><a href="#cb148-48" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span></span>
<span id="cb148-49"><a href="#cb148-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 0, c(1, 0)</span></span>
<span id="cb148-50"><a href="#cb148-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb148-51"><a href="#cb148-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb148-52"><a href="#cb148-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Island flooding</span></span>
<span id="cb148-53"><a href="#cb148-53" aria-hidden="true" tabindex="-1"></a>    child_state <span class="op">&lt;-</span> c(state[<span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb148-54"><a href="#cb148-54" aria-hidden="true" tabindex="-1"></a>    add_edge(</span>
<span id="cb148-55"><a href="#cb148-55" aria-hidden="true" tabindex="-1"></a>      vertex,</span>
<span id="cb148-56"><a href="#cb148-56" aria-hidden="true" tabindex="-1"></a>      find_or_create_vertex(graph, child_state),</span>
<span id="cb148-57"><a href="#cb148-57" aria-hidden="true" tabindex="-1"></a>      <span class="dv">4</span></span>
<span id="cb148-58"><a href="#cb148-58" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 0, c(0, 2)</span></span>
<span id="cb148-59"><a href="#cb148-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb148-60"><a href="#cb148-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb148-61"><a href="#cb148-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-62"><a href="#cb148-62" aria-hidden="true" tabindex="-1"></a>  index <span class="op">&lt;-</span> index <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb148-63"><a href="#cb148-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-64"><a href="#cb148-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-65"><a href="#cb148-65" aria-hidden="true" tabindex="-1"></a>states <span class="op">&lt;-</span> t(sapply(<span class="dv">1</span>:vertices_length(graph), function(index) vertex_at(graph, index)$state ))</span>
<span id="cb148-66"><a href="#cb148-66" aria-hidden="true" tabindex="-1"></a>ipv <span class="op">&lt;-</span> graph_as_matrix(graph)$IPV</span>
<span id="cb148-67"><a href="#cb148-67" aria-hidden="true" tabindex="-1"></a>sim <span class="op">&lt;-</span> graph_as_matrix(graph)$SIM</span>
<span id="cb148-68"><a href="#cb148-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-69"><a href="#cb148-69" aria-hidden="true" tabindex="-1"></a>vertices_length(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
</div>
<div id="386caa36" class="cell" data-execution_count="95">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>graph_update_weights_parameterized(graph, c(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="d3426abc" class="cell" data-execution_count="96">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>states <span class="op">&lt;-</span> t(sapply(<span class="dv">1</span>:vertices_length(graph), function(index) vertex_at(graph, index)$state ))</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>ipv <span class="op">&lt;-</span> graph_as_matrix(graph)$IPV</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>sim <span class="op">&lt;-</span> graph_as_matrix(graph)$SIM</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>states</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    0    0
[2,]    2    0
[3,]    1    1
[4,]    0    0
[5,]    0    2
[6,]    0    1
[7,]    2    0
[8,]    1    0</code></pre>
</div>
</div>
<div id="f74b705e" class="cell" data-execution_count="97">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>plot_graph(states, ipv, sim)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<div>
<figure class="figure">
<p><a href="showcase_files/figure-html/cell-93-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="showcase_files/figure-html/cell-93-output-1.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="ae9ed5a0" class="cell" data-execution_count="98">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>expectation(graph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5038265</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
</div>
</section>
<section id="running-time-experiments" class="level2">
<h2 class="anchored" data-anchor-id="running-time-experiments">Running time experiments</h2>
<div id="27850b57" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>cat(<span class="st">"rabbits,vertices,time_to_construct,time_build_moment_graph,time_compute_expectation,time_compute_first_10_moments</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>flush.console()</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (L <span class="kw">in</span> c(<span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>, <span class="dv">250</span>, <span class="dv">300</span>, <span class="dv">350</span>, <span class="dv">400</span>, <span class="dv">450</span>, <span class="dv">500</span>)) {</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>  tim <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>  state_vector_length <span class="op">&lt;-</span> <span class="dv">2</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>  graph <span class="op">&lt;-</span> create_graph(state_vector_length)</span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>  starting_vertex <span class="op">&lt;-</span> vertex_at(graph, <span class="dv">1</span>)</span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>  initial_state <span class="op">&lt;-</span> c(L, <span class="dv">0</span>)</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>  cat(L)</span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>  cat(<span class="st">","</span>)</span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>  flush.console()</span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>  add_edge(</span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>    starting_vertex,</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>    create_vertex(graph, initial_state),</span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>  index <span class="op">&lt;-</span> <span class="dv">2</span></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (index <span class="op">&lt;=</span> vertices_length(graph)) {</span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a>    vertex <span class="op">&lt;-</span> vertex_at(graph, index)</span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>    state <span class="op">&lt;-</span> vertex$state</span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (state[<span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Rabbit jump left to right</span></span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>      child_state <span class="op">&lt;-</span> c(state[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>, state[<span class="dv">2</span>] <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a>      add_edge(</span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a>        vertex,</span>
<span id="cb157-31"><a href="#cb157-31" aria-hidden="true" tabindex="-1"></a>        find_or_create_vertex(graph, child_state),</span>
<span id="cb157-32"><a href="#cb157-32" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span></span>
<span id="cb157-33"><a href="#cb157-33" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb157-34"><a href="#cb157-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb157-35"><a href="#cb157-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Island flooding</span></span>
<span id="cb157-36"><a href="#cb157-36" aria-hidden="true" tabindex="-1"></a>      child_state <span class="op">&lt;-</span> c(<span class="dv">0</span>, state[<span class="dv">2</span>])</span>
<span id="cb157-37"><a href="#cb157-37" aria-hidden="true" tabindex="-1"></a>      add_edge(</span>
<span id="cb157-38"><a href="#cb157-38" aria-hidden="true" tabindex="-1"></a>        vertex,</span>
<span id="cb157-39"><a href="#cb157-39" aria-hidden="true" tabindex="-1"></a>        find_or_create_vertex(graph, child_state),</span>
<span id="cb157-40"><a href="#cb157-40" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span></span>
<span id="cb157-41"><a href="#cb157-41" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb157-42"><a href="#cb157-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb157-43"><a href="#cb157-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-44"><a href="#cb157-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (state[<span class="dv">2</span>] <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb157-45"><a href="#cb157-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Rabbit jump right to left</span></span>
<span id="cb157-46"><a href="#cb157-46" aria-hidden="true" tabindex="-1"></a>      child_state <span class="op">&lt;-</span> c(state[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>, state[<span class="dv">2</span>] <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb157-47"><a href="#cb157-47" aria-hidden="true" tabindex="-1"></a>      add_edge(</span>
<span id="cb157-48"><a href="#cb157-48" aria-hidden="true" tabindex="-1"></a>        vertex,</span>
<span id="cb157-49"><a href="#cb157-49" aria-hidden="true" tabindex="-1"></a>        find_or_create_vertex(graph, child_state),</span>
<span id="cb157-50"><a href="#cb157-50" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span></span>
<span id="cb157-51"><a href="#cb157-51" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb157-52"><a href="#cb157-52" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb157-53"><a href="#cb157-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Island flooding</span></span>
<span id="cb157-54"><a href="#cb157-54" aria-hidden="true" tabindex="-1"></a>      child_state <span class="op">&lt;-</span> c(state[<span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb157-55"><a href="#cb157-55" aria-hidden="true" tabindex="-1"></a>      add_edge(</span>
<span id="cb157-56"><a href="#cb157-56" aria-hidden="true" tabindex="-1"></a>        vertex,</span>
<span id="cb157-57"><a href="#cb157-57" aria-hidden="true" tabindex="-1"></a>        find_or_create_vertex(graph, child_state),</span>
<span id="cb157-58"><a href="#cb157-58" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span></span>
<span id="cb157-59"><a href="#cb157-59" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb157-60"><a href="#cb157-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb157-61"><a href="#cb157-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-62"><a href="#cb157-62" aria-hidden="true" tabindex="-1"></a>    index <span class="op">&lt;-</span> index <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb157-63"><a href="#cb157-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-64"><a href="#cb157-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-65"><a href="#cb157-65" aria-hidden="true" tabindex="-1"></a>  cat(vertices_length(graph))</span>
<span id="cb157-66"><a href="#cb157-66" aria-hidden="true" tabindex="-1"></a>  cat(<span class="st">","</span>)</span>
<span id="cb157-67"><a href="#cb157-67" aria-hidden="true" tabindex="-1"></a>  now <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-68"><a href="#cb157-68" aria-hidden="true" tabindex="-1"></a>  cat((now <span class="op">-</span> tim)[<span class="dv">3</span>])</span>
<span id="cb157-69"><a href="#cb157-69" aria-hidden="true" tabindex="-1"></a>  cat(<span class="st">","</span>)</span>
<span id="cb157-70"><a href="#cb157-70" aria-hidden="true" tabindex="-1"></a>  flush.console()</span>
<span id="cb157-71"><a href="#cb157-71" aria-hidden="true" tabindex="-1"></a>  tim <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-72"><a href="#cb157-72" aria-hidden="true" tabindex="-1"></a>  expected_waiting_time(graph)</span>
<span id="cb157-73"><a href="#cb157-73" aria-hidden="true" tabindex="-1"></a>  now <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-74"><a href="#cb157-74" aria-hidden="true" tabindex="-1"></a>  cat((now <span class="op">-</span> tim)[<span class="dv">3</span>])</span>
<span id="cb157-75"><a href="#cb157-75" aria-hidden="true" tabindex="-1"></a>  cat(<span class="st">","</span>)</span>
<span id="cb157-76"><a href="#cb157-76" aria-hidden="true" tabindex="-1"></a>  flush.console()</span>
<span id="cb157-77"><a href="#cb157-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-78"><a href="#cb157-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-79"><a href="#cb157-79" aria-hidden="true" tabindex="-1"></a>  tim <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-80"><a href="#cb157-80" aria-hidden="true" tabindex="-1"></a>  expected_waiting_time(graph)</span>
<span id="cb157-81"><a href="#cb157-81" aria-hidden="true" tabindex="-1"></a>  now <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-82"><a href="#cb157-82" aria-hidden="true" tabindex="-1"></a>  cat((now <span class="op">-</span> tim)[<span class="dv">3</span>])</span>
<span id="cb157-83"><a href="#cb157-83" aria-hidden="true" tabindex="-1"></a>  cat(<span class="st">","</span>)</span>
<span id="cb157-84"><a href="#cb157-84" aria-hidden="true" tabindex="-1"></a>  flush.console()</span>
<span id="cb157-85"><a href="#cb157-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-86"><a href="#cb157-86" aria-hidden="true" tabindex="-1"></a>  tim <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-87"><a href="#cb157-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-88"><a href="#cb157-88" aria-hidden="true" tabindex="-1"></a>  rw <span class="op">&lt;-</span>  rep(<span class="dv">1</span>, vertices_length(graph))</span>
<span id="cb157-89"><a href="#cb157-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-90"><a href="#cb157-90" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="kw">in</span> <span class="dv">1</span>:<span class="dv">10</span>) {</span>
<span id="cb157-91"><a href="#cb157-91" aria-hidden="true" tabindex="-1"></a>    rw <span class="op">&lt;-</span> expected_waiting_time(graph, rw)</span>
<span id="cb157-92"><a href="#cb157-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-93"><a href="#cb157-93" aria-hidden="true" tabindex="-1"></a>  now <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-94"><a href="#cb157-94" aria-hidden="true" tabindex="-1"></a>  cat((now <span class="op">-</span> tim)[<span class="dv">3</span>])</span>
<span id="cb157-95"><a href="#cb157-95" aria-hidden="true" tabindex="-1"></a>  cat(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb157-96"><a href="#cb157-96" aria-hidden="true" tabindex="-1"></a>  flush.console()</span>
<span id="cb157-97"><a href="#cb157-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb157-98"><a href="#cb157-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-99"><a href="#cb157-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-100"><a href="#cb157-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-101"><a href="#cb157-101" aria-hidden="true" tabindex="-1"></a>cat(<span class="st">"rabbits,vertices,time_convert_matrix,time_inverse_matrix</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb157-102"><a href="#cb157-102" aria-hidden="true" tabindex="-1"></a>flush.console()</span>
<span id="cb157-103"><a href="#cb157-103" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (L <span class="kw">in</span> c(<span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>, <span class="dv">250</span>, <span class="dv">300</span>, <span class="dv">350</span>, <span class="dv">400</span>, <span class="dv">450</span>, <span class="dv">500</span>)) {</span>
<span id="cb157-104"><a href="#cb157-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-105"><a href="#cb157-105" aria-hidden="true" tabindex="-1"></a>  tim <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-106"><a href="#cb157-106" aria-hidden="true" tabindex="-1"></a>  state_vector_length <span class="op">&lt;-</span> <span class="dv">2</span></span>
<span id="cb157-107"><a href="#cb157-107" aria-hidden="true" tabindex="-1"></a>  graph <span class="op">&lt;-</span> create_graph(state_vector_length)</span>
<span id="cb157-108"><a href="#cb157-108" aria-hidden="true" tabindex="-1"></a>  starting_vertex <span class="op">&lt;-</span> vertex_at(graph, <span class="dv">1</span>)</span>
<span id="cb157-109"><a href="#cb157-109" aria-hidden="true" tabindex="-1"></a>  initial_state <span class="op">&lt;-</span> c(L, <span class="dv">0</span>)</span>
<span id="cb157-110"><a href="#cb157-110" aria-hidden="true" tabindex="-1"></a>  cat(L)</span>
<span id="cb157-111"><a href="#cb157-111" aria-hidden="true" tabindex="-1"></a>  cat(<span class="st">","</span>)</span>
<span id="cb157-112"><a href="#cb157-112" aria-hidden="true" tabindex="-1"></a>  flush.console()</span>
<span id="cb157-113"><a href="#cb157-113" aria-hidden="true" tabindex="-1"></a>  add_edge(</span>
<span id="cb157-114"><a href="#cb157-114" aria-hidden="true" tabindex="-1"></a>    starting_vertex,</span>
<span id="cb157-115"><a href="#cb157-115" aria-hidden="true" tabindex="-1"></a>    create_vertex(graph, initial_state),</span>
<span id="cb157-116"><a href="#cb157-116" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span></span>
<span id="cb157-117"><a href="#cb157-117" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb157-118"><a href="#cb157-118" aria-hidden="true" tabindex="-1"></a>  index <span class="op">&lt;-</span> <span class="dv">2</span></span>
<span id="cb157-119"><a href="#cb157-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-120"><a href="#cb157-120" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (index <span class="op">&lt;=</span> vertices_length(graph)) {</span>
<span id="cb157-121"><a href="#cb157-121" aria-hidden="true" tabindex="-1"></a>    vertex <span class="op">&lt;-</span> vertex_at(graph, index)</span>
<span id="cb157-122"><a href="#cb157-122" aria-hidden="true" tabindex="-1"></a>    state <span class="op">&lt;-</span> vertex$state</span>
<span id="cb157-123"><a href="#cb157-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-124"><a href="#cb157-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (state[<span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb157-125"><a href="#cb157-125" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Rabbit jump left to right</span></span>
<span id="cb157-126"><a href="#cb157-126" aria-hidden="true" tabindex="-1"></a>      child_state <span class="op">&lt;-</span> c(state[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>, state[<span class="dv">2</span>] <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb157-127"><a href="#cb157-127" aria-hidden="true" tabindex="-1"></a>      add_edge(</span>
<span id="cb157-128"><a href="#cb157-128" aria-hidden="true" tabindex="-1"></a>        vertex,</span>
<span id="cb157-129"><a href="#cb157-129" aria-hidden="true" tabindex="-1"></a>        find_or_create_vertex(graph, child_state),</span>
<span id="cb157-130"><a href="#cb157-130" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span></span>
<span id="cb157-131"><a href="#cb157-131" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb157-132"><a href="#cb157-132" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb157-133"><a href="#cb157-133" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Island flooding</span></span>
<span id="cb157-134"><a href="#cb157-134" aria-hidden="true" tabindex="-1"></a>      child_state <span class="op">&lt;-</span> c(<span class="dv">0</span>, state[<span class="dv">2</span>])</span>
<span id="cb157-135"><a href="#cb157-135" aria-hidden="true" tabindex="-1"></a>      add_edge(</span>
<span id="cb157-136"><a href="#cb157-136" aria-hidden="true" tabindex="-1"></a>        vertex,</span>
<span id="cb157-137"><a href="#cb157-137" aria-hidden="true" tabindex="-1"></a>        find_or_create_vertex(graph, child_state),</span>
<span id="cb157-138"><a href="#cb157-138" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span></span>
<span id="cb157-139"><a href="#cb157-139" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb157-140"><a href="#cb157-140" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb157-141"><a href="#cb157-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-142"><a href="#cb157-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (state[<span class="dv">2</span>] <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb157-143"><a href="#cb157-143" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Rabbit jump right to left</span></span>
<span id="cb157-144"><a href="#cb157-144" aria-hidden="true" tabindex="-1"></a>      child_state <span class="op">&lt;-</span> c(state[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>, state[<span class="dv">2</span>] <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb157-145"><a href="#cb157-145" aria-hidden="true" tabindex="-1"></a>      add_edge(</span>
<span id="cb157-146"><a href="#cb157-146" aria-hidden="true" tabindex="-1"></a>        vertex,</span>
<span id="cb157-147"><a href="#cb157-147" aria-hidden="true" tabindex="-1"></a>        find_or_create_vertex(graph, child_state),</span>
<span id="cb157-148"><a href="#cb157-148" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span></span>
<span id="cb157-149"><a href="#cb157-149" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb157-150"><a href="#cb157-150" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb157-151"><a href="#cb157-151" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Island flooding</span></span>
<span id="cb157-152"><a href="#cb157-152" aria-hidden="true" tabindex="-1"></a>      child_state <span class="op">&lt;-</span> c(state[<span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb157-153"><a href="#cb157-153" aria-hidden="true" tabindex="-1"></a>      add_edge(</span>
<span id="cb157-154"><a href="#cb157-154" aria-hidden="true" tabindex="-1"></a>        vertex,</span>
<span id="cb157-155"><a href="#cb157-155" aria-hidden="true" tabindex="-1"></a>        find_or_create_vertex(graph, child_state),</span>
<span id="cb157-156"><a href="#cb157-156" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span></span>
<span id="cb157-157"><a href="#cb157-157" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb157-158"><a href="#cb157-158" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb157-159"><a href="#cb157-159" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-160"><a href="#cb157-160" aria-hidden="true" tabindex="-1"></a>    index <span class="op">&lt;-</span> index <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb157-161"><a href="#cb157-161" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-162"><a href="#cb157-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-163"><a href="#cb157-163" aria-hidden="true" tabindex="-1"></a>  cat(vertices_length(graph))</span>
<span id="cb157-164"><a href="#cb157-164" aria-hidden="true" tabindex="-1"></a>  cat(<span class="st">","</span>)</span>
<span id="cb157-165"><a href="#cb157-165" aria-hidden="true" tabindex="-1"></a>  flush.console()</span>
<span id="cb157-166"><a href="#cb157-166" aria-hidden="true" tabindex="-1"></a>  tim <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-167"><a href="#cb157-167" aria-hidden="true" tabindex="-1"></a>  M <span class="op">&lt;-</span> graph_as_matrix(graph)</span>
<span id="cb157-168"><a href="#cb157-168" aria-hidden="true" tabindex="-1"></a>  now <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-169"><a href="#cb157-169" aria-hidden="true" tabindex="-1"></a>  cat((now <span class="op">-</span> tim)[<span class="dv">3</span>])</span>
<span id="cb157-170"><a href="#cb157-170" aria-hidden="true" tabindex="-1"></a>  cat(<span class="st">","</span>)</span>
<span id="cb157-171"><a href="#cb157-171" aria-hidden="true" tabindex="-1"></a>  flush.console()</span>
<span id="cb157-172"><a href="#cb157-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-173"><a href="#cb157-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-174"><a href="#cb157-174" aria-hidden="true" tabindex="-1"></a>  tim <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-175"><a href="#cb157-175" aria-hidden="true" tabindex="-1"></a>  solve(M$SIM)</span>
<span id="cb157-176"><a href="#cb157-176" aria-hidden="true" tabindex="-1"></a>  now <span class="op">&lt;-</span> proc.time()</span>
<span id="cb157-177"><a href="#cb157-177" aria-hidden="true" tabindex="-1"></a>  cat((now <span class="op">-</span> tim)[<span class="dv">3</span>])</span>
<span id="cb157-178"><a href="#cb157-178" aria-hidden="true" tabindex="-1"></a>  cat(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb157-179"><a href="#cb157-179" aria-hidden="true" tabindex="-1"></a>  flush.console()</span>
<span id="cb157-180"><a href="#cb157-180" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>rabbits,vertices,time_to_construct,time_build_moment_graph,time_compute_expectation,time_compute_first_10_moments
10,68,0.022,0.002,0,0.001
50,1328,0.114,0.015,0,0.002
100,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...
INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5153,1.567,0.043,0.001,0.014
150,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>11478,0.626,0.11,0.004,0.046
200,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>20303,1.129,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>0.281,0.01,0.096
250,31628,2.184,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>0.532,0.022,0.197
300,45453,3.139,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>0.869,0.035,0.314
350,61778,4.381,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>1.714,0.058,0.656
400,80603,7.666,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>3.927,0.148,1.349
450,101928,11.044,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5.916,0.199,1.846
500,125753,14.196,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO: building reward compute graph...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8.116,0.251,2.542
rabbits,vertices,time_convert_matrix,time_inverse_matrix
10,68,0,0.006
50,1328,0.019,0.159
100,5153,1.073,6.517
150,11478,4.46,58.847
200,20303,19.5,1361.119
250,31628,51.197,978.453
300,45453,110.844,</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/munch-group\.github\.io\/PtDAlgorithms\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>